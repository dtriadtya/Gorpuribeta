(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{5531:function(e,t,a){"use strict";a.d(t,{Z:function(){return createLucideIcon}});var r=a(2265);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let toKebabCase=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),toCamelCase=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase()),toPascalCase=e=>{let t=toCamelCase(e);return t.charAt(0).toUpperCase()+t.slice(1)},mergeClasses=(...e)=>e.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim(),hasA11yProp=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,r.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:a=2,absoluteStrokeWidth:l,className:s="",children:i,iconNode:o,...c},d)=>(0,r.createElement)("svg",{ref:d,...n,width:t,height:t,stroke:e,strokeWidth:l?24*Number(a)/Number(t):a,className:mergeClasses("lucide",s),...!i&&!hasA11yProp(c)&&{"aria-hidden":"true"},...c},[...o.map(([e,t])=>(0,r.createElement)(e,t)),...Array.isArray(i)?i:[i]])),createLucideIcon=(e,t)=>{let a=(0,r.forwardRef)(({className:a,...n},s)=>(0,r.createElement)(l,{ref:s,iconNode:t,className:mergeClasses(`lucide-${toKebabCase(toPascalCase(e))}`,`lucide-${e}`,a),...n}));return a.displayName=toPascalCase(e),a}},8203:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var r=a(5531);let n=(0,r.Z)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},6141:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var r=a(5531);let n=(0,r.Z)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},9670:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var r=a(5531);let n=(0,r.Z)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},5119:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var r=a(5531);let n=(0,r.Z)("layout-dashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]])},5883:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var r=a(5531);let n=(0,r.Z)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]])},6142:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var r=a(5531);let n=(0,r.Z)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},8004:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var r=a(5531);let n=(0,r.Z)("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]])},5367:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var r=a(5531);let n=(0,r.Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},9183:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var r=a(5531);let n=(0,r.Z)("users-round",[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]])},5750:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var r=a(5531);let n=(0,r.Z)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},2549:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var r=a(5531);let n=(0,r.Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},4406:function(e,t,a){Promise.resolve().then(a.bind(a,388))},388:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return AdminDashboard}});var r=a(7437),n=a(2265),l=a(4033),s=a(9250),i=a(636),o=a(6141);function DashboardOverview(e){let{bookingsToday:t,activeFields:a,reservations:l=[]}=e,[s,i]=(0,n.useState)(new Date().toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\./g,":"));(0,n.useEffect)(()=>{let e=setInterval(()=>{let e=new Date().toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\./g,":");i(e)},1e3);return()=>clearInterval(e)},[]);let c=new Date;return c.toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"2-digit"}).replace(/\./g,"/"),o.Z,null}var c=a(8203),d=a(5750),m=a(5531);let u=(0,m.Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var g=a(9670),p=a(7750),h=a(6820),x=a.n(h);let BookingTabs_getLocalDateString=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=new Date(e.getTime()+252e5);return t.toISOString().split("T")[0]};function BookingTabs(e){let{fields:t,bookings:a,reservations:l}=e,[s,i]=(0,n.useState)("latest"),[m,h]=(0,n.useState)(a),[y,f]=(0,n.useState)(null),[b,v]=(0,n.useState)(!1),[N,k]=(0,n.useState)([]),[w,j]=(0,n.useState)("");(0,n.useEffect)(()=>{let e=t.find(e=>e.isActive);e&&!w&&j(e.name)},[t,w]);let _=[...a].sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),D=localStorage.getItem("lastBookingId"),T=(0,n.useRef)(D?Number(D):_.length>0?_[0].id:null),S=(0,n.useRef)(0),C=(0,n.useRef)(!1),I=(0,n.useRef)(null),E=(0,n.useRef)(null);(0,n.useEffect)(()=>{E.current=new Audio("/sounds/notification.wav"),E.current.loop=!1},[]);let playNotificationSound=()=>{E.current&&(E.current.currentTime=0,E.current.play().catch(e=>console.warn("Gagal memutar suara:",e)))},startRepeatingSound=()=>{I.current||(playNotificationSound(),I.current=setInterval(()=>{playNotificationSound()},2500))},stopRepeatingSound=()=>{I.current&&(clearInterval(I.current),I.current=null),E.current&&(E.current.pause(),E.current.currentTime=0)},M=(0,n.useCallback)(async()=>{try{let e=localStorage.getItem("token"),t={};e&&(t.Authorization="Bearer ".concat(e));let a=await fetch("/api/admin/reservations",{cache:"no-store",headers:t});if(!a.ok)throw Error("Gagal mengambil data booking");let r=await a.json(),n=(r.reservations||[]).sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),l=n.map(e=>{var t,a,r;return{...e,payment_type:e.payment_type||"FULL",payment_amount:"number"!=typeof e.payment_amount||isNaN(e.payment_amount)?e.total_price:e.payment_amount,payment_validated_by:null!==(t=e.payment_validated_by)&&void 0!==t?t:null,payment_validated_at:null!==(a=e.payment_validated_at)&&void 0!==a?a:null,payment_validated_admin:null!==(r=e.payment_validated_admin)&&void 0!==r?r:null}}),s=l.slice(0,5);if(T.current){let e=s.findIndex(e=>e.id===T.current),t=0;e>0?t=e:-1===e&&s.length>0&&(t=s.length),t>0&&(S.current+=t,startRepeatingSound(),C.current?x().update({text:"Ada ".concat(S.current," pesanan masuk.")}):(C.current=!0,x().fire({title:"Pesanan Baru!",text:"Ada ".concat(S.current," pesanan masuk."),icon:"info",confirmButtonColor:"#16a34a",confirmButtonText:"OK",allowOutsideClick:!1,willClose:()=>{C.current=!1,S.current=0,stopRepeatingSound()}})))}s.length>0&&(T.current=s[0].id,localStorage.setItem("lastBookingId",s[0].id.toString())),h(s)}catch(e){console.error("Error fetching bookings:",e)}},[]);(0,n.useEffect)(()=>{M();let e=setInterval(M,5e3);return()=>{clearInterval(e),stopRepeatingSound()}},[M]),(0,n.useEffect)(()=>{let fetchMembers=async()=>{try{let e=localStorage.getItem("token"),t={};e&&(t.Authorization="Bearer ".concat(e));let a=await fetch("/api/admin/members",{headers:t});if(a.ok){let e=await a.json();k(e.members||[])}}catch(e){console.error("Gagal memuat data member:",e)}};fetchMembers();let e=setInterval(fetchMembers,3e4);return()=>clearInterval(e)},[]);let getPaymentStatusInfo=(e,t)=>{switch(e){case"PENDING":return{label:"Menunggu",color:"bg-yellow-100 text-yellow-800"};case"FULL_SENT":return{label:"Bukti Lunas Terkirim",color:"bg-blue-100 text-blue-800"};case"FULL_REJECTED":return{label:"Ditolak Admin",color:"bg-red-100 text-red-800"};case"DP_SENT":return{label:"DP Terkirim",color:"bg-blue-100 text-blue-800"};case"DP_PAID":return{label:"DP Terbayar",color:"bg-blue-200 text-blue-900"};case"DP_REJECTED":return{label:"DP Ditolak",color:"bg-red-100 text-red-800"};case"PELUNASAN_SENT":return{label:"Pelunasan Terkirim",color:"bg-purple-100 text-purple-800"};case"PELUNASAN_PAID":return{label:"Pelunasan Terbayar",color:"bg-purple-200 text-purple-900"};case"PELUNASAN_REJECTED":return{label:"Pelunasan Ditolak",color:"bg-red-100 text-red-800"};case"PAID":return{label:"Lunas",color:"bg-green-100 text-green-800"};case"REFUNDED":return{label:"Dikembalikan",color:"bg-red-100 text-red-800"};default:return{label:e,color:"bg-gray-100 text-gray-800"}}},formatDate=e=>{let t=new Date(e);return"".concat(String(t.getDate()).padStart(2,"0"),"/").concat(String(t.getMonth()+1).padStart(2,"0"),"/").concat(String(t.getFullYear()).slice(-2))},formatCurrency=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e),handleViewDetail=e=>{f(e),v(!0)},handlePaymentStatusUpdate=async(e,t,a)=>{try{let r=localStorage.getItem("token"),n=await fetch("/api/reservations/".concat(e,"/payment"),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({paymentStatus:t,adminNotes:a})});if(!n.ok){let e=await n.json();x().fire({icon:"error",title:"Gagal",text:e.error||"Gagal memperbarui status pembayaran",confirmButtonColor:"#16a34a"});return}await M(),x().fire({icon:"success",title:"Berhasil!",text:"Status pembayaran berhasil diperbarui",confirmButtonColor:"#16a34a"})}catch(e){console.error("Error updating payment status:",e),x().fire({icon:"error",title:"Error",text:"Terjadi kesalahan saat memperbarui status pembayaran",confirmButtonColor:"#16a34a"})}},P=BookingTabs_getLocalDateString(),A=new Date().toLocaleDateString("en-US",{weekday:"long"}).toUpperCase();console.log("=== TODAY PLAYERS DEBUG ==="),console.log("Today String:",P),console.log("Day of Week:",A),console.log("Total Reservations:",l.length),console.log("Total Members:",N.length);let L=l.filter(e=>{let t=BookingTabs_getLocalDateString(new Date(e.reservation_date)),a="PAID"===e.payment_status,r="COMPLETED"===e.status,n=t===P&&(a||r);if(n){var l;console.log("Today Player Found:",{name:null===(l=e.user)||void 0===l?void 0:l.name,field_name:e.field_name,date:t,status:e.status,payment_status:e.payment_status})}return n});console.log("Filtered Today Players:",L.length);let Z=N.filter(e=>e.dayOfWeek===A&&e.isActive);console.log("Filtered Today Members:",Z.length),console.log("Today Members Data:",Z),Z.forEach(e=>{console.log("Member:",{name:e.name,fieldName:e.fieldName,contactName:e.contactName,startTime:e.startTime,endTime:e.endTime})});let B=[...L.map(e=>{var t,a,r;return{type:"booking",name:(null===(t=e.user)||void 0===t?void 0:t.name)||"Tanpa Nama",contact:(null===(a=e.user)||void 0===a?void 0:a.phone)||(null===(r=e.user)||void 0===r?void 0:r.email)||"-",field:e.field_name,startTime:e.start_time,endTime:e.end_time,data:e}}),...Z.map(e=>{var t;return{type:"member",name:e.name,contact:e.contactName,field:(null===(t=e.field)||void 0===t?void 0:t.name)||e.fieldName||"Lapangan Tidak Diketahui",startTime:e.startTime,endTime:e.endTime,data:e}})].sort((e,t)=>{let a=e.startTime.split(":").map(Number),r=t.startTime.split(":").map(Number),n=60*a[0]+a[1],l=60*r[0]+r[1],s=new Date,i=60*s.getHours()+s.getMinutes(),o=e.endTime.split(":").map(Number),c=t.endTime.split(":").map(Number),d=60*o[0]+o[1],m=60*c[0]+c[1],u=i>=d,g=i>=m;return u&&!g?1:!u&&g?-1:n-l});console.log("Combined Today Players:",B),console.log("Combined Players Fields:",B.map(e=>e.field));let U=t.filter(e=>e.isActive).map(e=>e.name).sort();console.log("All Active Fields:",U);let F="all"===w?B:B.filter(e=>e.field===w),getTimeInMinutes=e=>{let[t,a]=e.split(":").map(Number);return 60*t+a},R=new Date,O=60*R.getHours()+R.getMinutes(),getCardBackgroundClass=e=>{let t=getTimeInMinutes(e.startTime),a=getTimeInMinutes(e.endTime);return O>=a?"bg-gray-100 border-gray-300 opacity-75":O>=t&&O<a?"bg-green-50 border-green-200":"bg-white border-gray-200"},z=l.filter(e=>{let t=BookingTabs_getLocalDateString(new Date(e.reservation_date)),a="PAID"===e.payment_status,r=["CANCELLED","REJECTED","DP_REJECTED"].includes(e.status);return t===P&&!a&&!r}).sort((e,t)=>{let a=e.start_time.split(":").map(Number),r=t.start_time.split(":").map(Number);return 60*a[0]+a[1]-(60*r[0]+r[1])}),G=[{id:"latest",label:"Booking Terbaru",icon:c.Z,count:m.length},{id:"today",label:"Pemain Hari Ini",icon:d.Z,count:B.length},{id:"unpaid",label:"Belum Lunas",icon:u,count:z.length}];return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 relative overflow-hidden",children:[(0,r.jsx)("div",{className:"p-4 sm:p-6 pb-0",children:(0,r.jsx)("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide",children:G.map(e=>{let t=e.icon;return(0,r.jsxs)("button",{onClick:()=>i(e.id),className:"flex items-center gap-2 px-4 py-3 text-sm font-medium whitespace-nowrap rounded-t-lg transition-all ".concat(s===e.id?"bg-white text-blue-600 shadow-md border-t border-x border-gray-200 -mb-px z-10":"bg-gray-50 text-gray-600 hover:bg-gray-100 hover:text-gray-800"),children:[(0,r.jsx)(t,{className:"w-4 h-4"}),e.label,e.count>0&&(0,r.jsx)("span",{className:"px-2 py-0.5 text-xs font-semibold rounded-full ".concat(s===e.id?"bg-blue-100 text-blue-800":"bg-gray-200 text-gray-700"),children:e.count})]},e.id)})})}),(0,r.jsxs)("div",{className:"p-4 sm:p-6 border-t border-gray-200",children:["latest"===s&&(0,r.jsx)(r.Fragment,{children:0===m.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(c.Z,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"Belum ada booking"})]}):(0,r.jsx)("div",{className:"flex flex-col gap-4",children:m.map(e=>(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-4 sm:p-5 shadow-sm flex flex-col sm:flex-row sm:items-center gap-4 transition-all duration-300",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"font-medium text-gray-900 truncate",children:e.user.name}),(0,r.jsx)("p",{className:"text-sm text-gray-600 truncate",children:e.field_name})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center text-sm text-gray-700 min-w-[140px]",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4 text-gray-500"}),(0,r.jsx)("span",{children:formatDate(e.reservation_date)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 mt-1",children:[(0,r.jsx)(o.Z,{className:"w-4 h-4 text-gray-500"}),(0,r.jsxs)("span",{children:[e.start_time," – ",e.end_time]})]})]}),(0,r.jsx)("div",{className:"flex items-center justify-center min-w-[100px]",children:(0,r.jsx)("span",{className:"inline-flex items-center justify-center px-3 py-1 rounded-full text-xs font-medium ".concat(getPaymentStatusInfo(e.payment_status||"PENDING",e.payment_type||"FULL").color),children:getPaymentStatusInfo(e.payment_status||"PENDING",e.payment_type||"FULL").label})}),(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsx)("button",{onClick:()=>handleViewDetail(e),className:"p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors",title:"Lihat Detail",children:(0,r.jsx)(g.Z,{className:"w-5 h-5"})})})]},e.id))})}),"today"===s&&(0,r.jsxs)(r.Fragment,{children:[U.length>0&&(0,r.jsx)("div",{className:"mb-4 border-b border-gray-200",children:(0,r.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent",children:U.map(e=>{let t=B.filter(t=>t.field===e).length;return(0,r.jsxs)("button",{onClick:()=>j(e),className:"px-4 py-2 text-sm font-medium whitespace-nowrap rounded-t-lg transition-all ".concat(w===e?"bg-blue-50 text-blue-700 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"),children:[e,(0,r.jsx)("span",{className:"ml-2 px-2 py-0.5 text-xs rounded-full bg-gray-200 text-gray-700",children:t})]},e)})})}),0===F.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(d.Z,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"all"===w?"Belum ada pemain hari ini":"Belum ada pemain di ".concat(w," hari ini")})]}):(0,r.jsx)("div",{className:"flex flex-col gap-4 ".concat(F.length>5?"max-h-[600px] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent":""),children:F.map((e,t)=>(0,r.jsxs)("div",{className:"".concat(getCardBackgroundClass(e)," border rounded-xl p-4 sm:p-5 shadow-sm flex flex-col sm:flex-row sm:items-center gap-4 transition-all duration-300"),children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("p",{className:"font-medium text-gray-900 truncate",children:e.name}),"member"===e.type&&(0,r.jsx)("span",{className:"px-2 py-0.5 text-xs font-semibold bg-amber-100 text-amber-800 rounded-full",children:"Member"}),"booking"===e.type&&(0,r.jsx)("span",{className:"px-2 py-0.5 text-xs font-semibold bg-blue-100 text-blue-800 rounded-full",children:"User"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:e.contact})]}),(0,r.jsx)("div",{className:"flex flex-col items-center text-sm text-gray-700 min-w-[140px]",children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(o.Z,{className:"w-4 h-4 text-gray-500"}),(0,r.jsxs)("span",{children:[e.startTime," – ",e.endTime]})]})})]},"".concat(e.type,"-").concat(t)))})]}),"unpaid"===s&&(0,r.jsx)(r.Fragment,{children:0===z.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(u,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"Tidak ada booking yang belum lunas hari ini"})]}):(0,r.jsx)("div",{className:"flex flex-col gap-4 ".concat(z.length>5?"max-h-[600px] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent":""),children:z.map(e=>{var t,a;return(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-4 sm:p-5 shadow-sm flex flex-col sm:flex-row sm:items-center gap-4 transition-all duration-300",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"font-medium text-gray-900 truncate",children:(null===(t=e.user)||void 0===t?void 0:t.name)||"Tanpa Nama"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 truncate",children:e.field_name||"Tidak Diketahui"}),(null===(a=e.user)||void 0===a?void 0:a.phone)&&(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:e.user.phone})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center text-sm text-gray-700 min-w-[140px]",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4 text-gray-500"}),(0,r.jsx)("span",{children:formatDate(e.reservation_date)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 mt-1",children:[(0,r.jsx)(o.Z,{className:"w-4 h-4 text-gray-500"}),(0,r.jsxs)("span",{children:[e.start_time," – ",e.end_time]})]})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center min-w-[120px]",children:[(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"Total"}),(0,r.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:formatCurrency(e.total_price)})]}),(0,r.jsx)("div",{className:"flex items-center justify-center min-w-[140px]",children:(0,r.jsx)("span",{className:"inline-flex items-center justify-center px-3 py-1 rounded-full text-xs font-medium ".concat(getPaymentStatusInfo(e.payment_status||"PENDING",e.payment_type||"FULL").color),children:getPaymentStatusInfo(e.payment_status||"PENDING",e.payment_type||"FULL").label})})]},e.id)})})})]})]}),y&&(0,r.jsx)(p.Z,{reservation:y,isOpen:b,onClose:()=>{v(!1),f(null)},onPaymentStatusUpdate:handlePaymentStatusUpdate})]})}function AdminDashboard(){let[e,t]=(0,n.useState)(null),[a,o]=(0,n.useState)([]),[c,d]=(0,n.useState)([]),[m,u]=(0,n.useState)(!0),[g,p]=(0,n.useState)(!1),h=(0,l.useRouter)();(0,n.useEffect)(()=>{let checkAuthAndFetchData=async()=>{let e=sessionStorage.getItem("justLoggedIn");e&&(sessionStorage.removeItem("justLoggedIn"),await new Promise(e=>setTimeout(e,100)));let a=localStorage.getItem("token"),r=localStorage.getItem("user");if(console.log("\uD83D\uDD10 Admin: Checking auth...",{token:!!a,userData:!!r}),!a||!r){console.log("❌ Admin: No auth data, redirecting to login"),h.replace("/login");return}try{let e=JSON.parse(r);if(console.log("\uD83D\uDC64 Admin: User role:",e.role),"ADMIN"!==e.role){console.log("\uD83D\uDEAB Admin: Not admin, redirecting to dashboard"),h.replace("/dashboard");return}console.log("✅ Admin: Auth successful"),t(e),u(!1),await fetchData();let a=setInterval(()=>{fetchData()},5e3);return()=>clearInterval(a)}catch(e){console.error("❌ Admin: Error parsing user data:",e),localStorage.removeItem("token"),localStorage.removeItem("user"),h.replace("/login")}};checkAuthAndFetchData()},[h]);let fetchData=async()=>{try{let e=localStorage.getItem("token"),t={};e&&(t.Authorization="Bearer ".concat(e));let[a,r]=await Promise.all([fetch("/api/v1/fields"),fetch("/api/admin/reservations",{headers:t})]);if(a.ok){let e=await a.json();o(e.fields||[])}if(r.ok){let e=await r.json();d(e.reservations||[])}else 401===r.status&&(console.log("❌ Unauthorized - redirecting to login"),h.replace("/login"))}catch(e){console.error("Error fetching data:",e)}finally{u(!1)}};if(m)return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Memuat data..."})]})});if(!e)return null;let x=c.length>0?new Set(c.map(e=>e.user_id)).size:0,y=c.reduce((e,t)=>e+t.total_price,0),f=c.filter(e=>{let t=new Date(e.reservation_date).toDateString(),a=new Date().toDateString();return t===a}),b=a.filter(e=>e.isActive).length,calculatePercentageChange=(e,t)=>0===t?e>0?100:0:Math.round((e-t)/t*100),v=Math.max(1,Math.floor(.9*x)),N=Math.max(1,Math.floor(.9*f.length)),k=Math.max(1,Math.floor(.85*y)),w=Math.max(1,Math.floor(1.02*b)),j=calculatePercentageChange(x,v),_=calculatePercentageChange(f.length,N),D=calculatePercentageChange(y,k),T=calculatePercentageChange(b,w);return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(s.Z,{isOpen:g,setIsOpen:p}),(0,r.jsxs)("div",{className:"lg:ml-64",children:[(0,r.jsx)(i.Z,{title:"Dashboard Admin",onMenuClick:()=>p(!0)}),(0,r.jsxs)("div",{className:"px-6 pt-0.5 pb-4",children:[(0,r.jsx)(DashboardOverview,{bookingsToday:f.length,totalRevenue:y,activeFields:b,usersChange:j,bookingsChange:_,revenueChange:D,fieldsChange:T,reservations:c}),(0,r.jsx)("div",{className:"mt-6 lg:mt-8",children:(0,r.jsx)(BookingTabs,{fields:a,bookings:c.slice(0,5).map(e=>({...e,user:e.user||{id:0,name:"Unknown",email:"",phone:""},field:{id:e.field_id,name:e.field_name,location:e.location},payment_type:e.payment_type||"FULL",payment_amount:e.total_price,payment_validated_by:null,payment_validated_at:null,payment_validated_admin:null})),reservations:c.map(e=>({...e,user:e.user||{id:0,name:"Unknown",email:"",phone:""},field:{id:e.field_id,name:e.field_name,location:e.location},payment_type:e.payment_type||"FULL",payment_amount:e.total_price,payment_validated_by:null,payment_validated_at:null,payment_validated_admin:null}))})})]})]})]})}},4033:function(e,t,a){e.exports=a(94)}},function(e){e.O(0,[461,176,466,971,472,744],function(){return e(e.s=4406)}),_N_E=e.O()}]);