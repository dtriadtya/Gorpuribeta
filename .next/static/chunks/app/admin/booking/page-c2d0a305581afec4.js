(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[729],{5545:function(e,t,a){Promise.resolve().then(a.bind(a,9680))},9680:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return BookingManagement}});var r=a(7437),n=a(2265),s=a(4033),l=a(9250),i=a(636),o=a(1827),d=a(3523),c=a(5817),m=a(9670),u=a(8203),g=a(2549),x=a(7750),h=a(6141),p=a(3067),b=a(8291),f=a(6820),y=a.n(f);function RescheduleModal(e){let{isOpen:t,onClose:a,reservation:s,onSuccess:l}=e,[i,o]=(0,n.useState)(""),[d,c]=(0,n.useState)([]),[m,x]=(0,n.useState)(""),[f,j]=(0,n.useState)(!1),[v,w]=(0,n.useState)(new Date),[N,D]=(0,n.useState)(!0),[k,S]=(0,n.useState)([]),formatDate=e=>{let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(r)},parseDateString=e=>{let[t,a,r]=e.split("-").map(Number);return new Date(t,a-1,r)},isToday=e=>e.toDateString()===new Date().toDateString(),isPast=e=>{let t=new Date;return t.setHours(0,0,0,0),e<t};(0,n.useEffect)(()=>{t&&s.field_id&&(fetchScheduleData(s.field_id),o(""),c([]),x(""),D(!0))},[t,s]),(0,n.useEffect)(()=>{if(!t||!s.field_id)return;let e=setInterval(()=>{fetchScheduleData(s.field_id)},2e3);return()=>clearInterval(e)},[t,s.field_id]);let fetchScheduleData=async e=>{try{let t=await fetch("/api/schedule?fieldId=".concat(e,"&t=").concat(Date.now()));if(t.ok){let e=await t.json();S(e.schedule)}}catch(e){console.error("Error fetching schedule:",e)}},handleDateSelect=e=>{!e||isPast(e)||(o(formatDate(e)),c([]),D(!1))},getTimeSlotsForDate=e=>{let t=formatDate(e),a=k.find(e=>e.date===t),r=[];for(let t=8;t<22;t++){let n="".concat(t.toString().padStart(2,"0"),":00"),s=null==a?void 0:a.timeSlots.find(e=>e.time===n);if(s)r.push(s);else{let a=isToday(e)&&t<new Date().getHours();r.push({time:n,available:!a,status:a?"booked":"available"})}}return r},handleTimeSlotClick=e=>{if(0===d.length){c([e]);return}if(d.includes(e)){c([]);return}let t=getTimeSlotsForDate(parseDateString(i)),a=d[0],r=t.findIndex(e=>e.time===a),n=t.findIndex(t=>t.time===e);if(-1===r||-1===n)return;let s=Math.min(r,n),l=Math.max(r,n),o=[];for(let e=s;e<=l;e++){if(!t[e].available)return;o.push(t[e].time)}c(o)},handleSubmit=async e=>{if(e.preventDefault(),!i||0===d.length){y().fire({icon:"warning",title:"Data Tidak Lengkap",text:"Harap pilih tanggal dan waktu untuk reschedule",confirmButtonColor:"#2563eb"});return}let t=d[0],r=d[d.length-1],n=parseInt(r.split(":")[0])+1,o="".concat(n.toString().padStart(2,"0"),":00");j(!0);try{let e=localStorage.getItem("token"),r=await fetch("/api/reservations/".concat(s.id,"/reschedule"),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({newDate:i,newStartTime:t,newEndTime:o,adminNotes:"Reschedule dari ".concat(s.reservation_date," ").concat(s.start_time,"-").concat(s.end_time)})}),n=await r.json();r.ok?(y().fire({icon:"success",title:"Berhasil!",text:"Booking berhasil di-reschedule",confirmButtonColor:"#2563eb",timer:2e3}),l(),a()):y().fire({icon:"error",title:"Gagal",text:n.error||"Gagal melakukan reschedule",confirmButtonColor:"#2563eb"})}catch(e){console.error("Error rescheduling:",e),y().fire({icon:"error",title:"Error",text:"Terjadi kesalahan saat melakukan reschedule",confirmButtonColor:"#2563eb"})}finally{j(!1)}};if(!t)return null;let _=(()=>{let e=v.getFullYear(),t=v.getMonth(),a=new Date(e,t,1),r=new Date(e,t+1,0),n=a.getDay(),s=r.getDate(),l=Array(n).fill(null);for(let a=1;a<=s;a++)l.push(new Date(e,t,a));return l})(),C=i?getTimeSlotsForDate(parseDateString(i)):[];return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-xl flex justify-between items-center z-10",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold",children:"Reschedule Booking"}),(0,r.jsxs)("p",{className:"text-blue-100 text-sm mt-1",children:[s.field_name," - ",s.user.name]})]}),(0,r.jsx)("button",{onClick:a,className:"text-white hover:bg-white/20 rounded-lg p-2 transition",children:(0,r.jsx)(g.Z,{className:"w-6 h-6"})})]}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[(0,r.jsx)("h3",{className:"font-semibold text-blue-900 mb-2",children:"Jadwal Saat Ini:"}),(0,r.jsxs)("div",{className:"text-sm text-blue-800 space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(u.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:new Date(s.reservation_date).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(h.Z,{className:"w-4 h-4"}),(0,r.jsxs)("span",{children:[s.start_time," - ",s.end_time]})]})]})]}),(0,r.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:N?"Pilih Tanggal Baru":"Pilih Waktu Baru"}),!N&&(0,r.jsxs)("button",{type:"button",onClick:()=>D(!0),className:"px-3 py-1 text-sm bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200",children:[(0,r.jsx)(u.Z,{className:"w-4 h-4 inline mr-1"})," Ubah Tanggal"]})]}),N&&(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("button",{type:"button",onClick:()=>{let e=new Date(v);e.setMonth(e.getMonth()-1);let t=new Date;e.getFullYear()<t.getFullYear()||e.getFullYear()===t.getFullYear()&&e.getMonth()<t.getMonth()||w(e)},className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,r.jsx)(p.Z,{className:"w-5 h-5"})}),(0,r.jsx)("h4",{className:"text-base font-semibold text-gray-900",children:v.toLocaleDateString("id-ID",{month:"long",year:"numeric"})}),(0,r.jsx)("button",{type:"button",onClick:()=>{let e=new Date(v);e.setMonth(e.getMonth()+1),w(e)},className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,r.jsx)(b.Z,{className:"w-5 h-5"})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-7 gap-2",children:[["Min","Sen","Sel","Rab","Kam","Jum","Sab"].map(e=>(0,r.jsx)("div",{className:"text-center text-sm font-medium text-gray-500 py-2",children:e},e)),_.map((e,t)=>{if(!e)return(0,r.jsx)("div",{className:"p-3"},"empty-".concat(t));let a=formatDate(e),n=k.find(e=>e.date===a),s=n?n.timeSlots.filter(e=>"booked"===e.status).length:0,l=s>=14,o=isPast(e)||l,d=i===a,c=isToday(e);return(0,r.jsx)("button",{type:"button",onClick:()=>handleDateSelect(e),disabled:o,className:"\n                            p-3 rounded-lg text-sm font-medium transition-all\n                            ".concat(d?"bg-primary-600 text-white ring-2 ring-primary-300":l?"bg-red-100 text-red-500 cursor-not-allowed border border-red-200":o?"bg-gray-100 text-gray-300 cursor-not-allowed":c?"bg-blue-50 text-blue-600 border-2 border-blue-300 hover:bg-blue-100":"bg-gray-50 text-gray-700 hover:bg-gray-100 hover:ring-2 hover:ring-gray-200","\n                          "),children:(0,r.jsx)("div",{children:e.getDate()})},t)})]}),(0,r.jsx)("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:(0,r.jsxs)("p",{className:"text-sm text-blue-800",children:["\uD83D\uDCA1 ",(0,r.jsx)("strong",{children:"Tips:"})," Pilih tanggal pada kalender untuk melihat slot waktu yang tersedia"]})})]}),!N&&i&&(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:["Pilih Waktu - ",parseDateString(i).toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Klik waktu mulai, lalu klik waktu akhir untuk memilih range. Contoh ingin reschedule 2 jam maka klik 08:00 dan 09:00 dst."}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 text-xs",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-gray-50 border border-gray-200 rounded"}),(0,r.jsx)("span",{className:"text-gray-600",children:"Tersedia"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-primary-600 rounded"}),(0,r.jsx)("span",{className:"text-gray-600",children:"Terpilih"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-red-100 border border-red-200 rounded"}),(0,r.jsx)("span",{className:"text-gray-600",children:"Terbooking"})]})]})]}),(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3",children:C.map(e=>{let t=d.includes(e.time),a=d[0]===e.time,n=d[d.length-1]===e.time,s=d.length>1&&t&&!a&&!n;return(0,r.jsxs)("button",{type:"button",onClick:()=>handleTimeSlotClick(e.time),disabled:!e.available||"booked"===e.status,className:"\n                            p-2 sm:p-3 rounded-lg text-[11px] sm:text-sm font-medium transition-colors\n                            ".concat(t?"bg-primary-600 text-white":"booked"===e.status?"bg-red-100 text-red-600 border border-red-200 cursor-not-allowed":e.available?"bg-gray-50 text-gray-700 hover:bg-gray-100 border border-gray-200":"bg-gray-100 text-gray-400 cursor-not-allowed","\n                            ").concat(a&&d.length>1?"rounded-l-lg":"","\n                            ").concat(n&&d.length>1?"rounded-r-lg":"","\n                            ").concat(s?"rounded-none":"","\n                          "),children:[(0,r.jsxs)("div",{children:[e.time," - ",String(parseInt(e.time.split(":")[0])+1).padStart(2,"0"),":00"]}),(0,r.jsx)("div",{className:"text-[9px] sm:text-xs opacity-75 mt-0.5",children:"booked"===e.status?"Terbooking":"Tersedia"})]},e.time)})})]})]}),i&&d.length>0&&(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,r.jsx)("h3",{className:"font-semibold text-blue-900 mb-3",children:"Ringkasan Reschedule:"}),(0,r.jsxs)("div",{className:"space-y-2 text-sm text-blue-800",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-blue-600",children:"Tanggal:"})," ",(0,r.jsx)("span",{className:"font-medium",children:parseDateString(i).toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-blue-600",children:"Waktu:"})," ",(0,r.jsxs)("span",{className:"font-medium",children:[d[0]," - ",(()=>{let e=d[d.length-1],t=parseInt(e.split(":")[0])+1;return"".concat(t.toString().padStart(2,"0"),":00")})()]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-blue-600",children:"Durasi:"})," ",(0,r.jsxs)("span",{className:"font-medium",children:[d.length," jam"]})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Catatan Admin (Opsional)"}),(0,r.jsx)("textarea",{value:m,onChange:e=>x(e.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Tambahkan catatan untuk reschedule ini..."})]}),(0,r.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,r.jsxs)("p",{className:"text-sm text-yellow-800",children:[(0,r.jsx)("strong",{children:"⚠️ Perhatian:"})," Pastikan jadwal baru tidak bentrok dengan booking lain. User akan menerima notifikasi perubahan jadwal."]})}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,r.jsx)("button",{type:"button",onClick:a,className:"flex-1 px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition",disabled:f,children:"Batal"}),(0,r.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition disabled:opacity-50 disabled:cursor-not-allowed",disabled:f,children:f?"Memproses...":"Simpan"})]})]})]})]})})}var j=a(930),v=a(9320);function BookingManagement(){var e;let[t,a]=(0,n.useState)(null),[h,p]=(0,n.useState)([]),[b,f]=(0,n.useState)(!0),[w,N]=(0,n.useState)(!1),[D,k]=(0,n.useState)(""),[S,_]=(0,n.useState)("ALL"),[C,T]=(0,n.useState)(""),[P,E]=(0,n.useState)(""),[L,A]=(0,n.useState)(""),[I,R]=(0,n.useState)(null),[M,B]=(0,n.useState)(!1),[F,J]=(0,n.useState)(!1),[U,Z]=(0,n.useState)(null),[O,z]=(0,n.useState)(null),[W,G]=(0,n.useState)(!1),[H,Y]=(0,n.useState)(!1),[K,V]=(0,n.useState)(null),q=(0,s.useRouter)();(0,n.useEffect)(()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("user");if(console.log("Booking page auth check:",{token:!!e,userData:!!t}),!e||!t){console.log("No token or user data, redirecting to login"),window.location.replace("/login");return}try{let e=JSON.parse(t);if(console.log("Parsed user:",e),"ADMIN"!==e.role){console.log("User is not admin, redirecting to home"),window.location.replace("/");return}a(e),fetchReservations()}catch(e){console.error("Error parsing user data:",e),localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.replace("/login")}},[]),(0,n.useEffect)(()=>{let e=setInterval(()=>{fetchReservations()},5e3);return()=>clearInterval(e)},[]);let Q=(0,n.useRef)(null);(0,n.useEffect)(()=>{let handleClickOutside=e=>{Q.current&&!Q.current.contains(e.target)&&G(!1)};return document.addEventListener("mousedown",handleClickOutside),()=>{document.removeEventListener("mousedown",handleClickOutside)}},[]);let fetchReservations=async()=>{try{let e=localStorage.getItem("token"),t={};e&&(t.Authorization="Bearer ".concat(e));let a=await fetch("/api/admin/reservations",{headers:t});if(401===a.status){console.log("❌ Unauthorized - redirecting to login"),q.push("/login");return}if(a.ok){let e=await a.json(),t=(e.reservations||[]).sort((e,t)=>new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime()),r=t.map(e=>{var t,a,r;return{...e,payment_type:e.payment_type||"FULL",payment_amount:"number"!=typeof e.payment_amount||isNaN(e.payment_amount)?e.total_price:e.payment_amount,payment_validated_by:null!==(t=e.payment_validated_by)&&void 0!==t?t:null,payment_validated_at:null!==(a=e.payment_validated_at)&&void 0!==a?a:null,payment_validated_admin:null!==(r=e.payment_validated_admin)&&void 0!==r?r:null}});p(r)}}catch(e){console.error("Error fetching reservations:",e)}finally{f(!1)}},handlePaymentStatusUpdate=async(e,t,a)=>{if("REJECT_PELUNASAN"===t||"REJECT_DP"===t||"REJECT_FULL"===t){fetchReservations(),B(!1),R(null);return}try{let r=localStorage.getItem("token");if(!r){y().fire({icon:"error",title:"Tidak ada sesi",text:"Silakan login ulang sebagai admin",confirmButtonColor:"#2563eb"});return}let n=await fetch("/api/reservations/".concat(e,"/payment"),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({paymentStatus:t,adminNotes:a})});if(n.ok)fetchReservations(),y().fire({icon:"success",title:"Berhasil!",text:"Status pembayaran berhasil diperbarui",confirmButtonColor:"#2563eb",timer:2e3}),B(!1),R(null);else{let e=await n.json();if(401===n.status){y().fire({icon:"error",title:"Tidak Terotorisasi",text:"Sesi admin tidak valid. Login ulang diperlukan.",confirmButtonColor:"#2563eb"});return}y().fire({icon:"error",title:"Gagal",text:e.error||"Gagal memperbarui status pembayaran",confirmButtonColor:"#2563eb"})}}catch(e){console.error("Error updating payment status:",e),y().fire({icon:"error",title:"Gagal",text:"Terjadi kesalahan saat memperbarui status pembayaran",confirmButtonColor:"#2563eb"})}},handleShowDetail=e=>{R(e),B(!0)},handleShowReschedule=e=>{V(e),Y(!0)},X=h.filter(e=>{var t;let a=e.user.name.toLowerCase().includes(D.toLowerCase())||e.field_name.toLowerCase().includes(D.toLowerCase())||(null===(t=e.user.phone)||void 0===t?void 0:t.includes(D)),r="ALL"===S||e.status===S,n=new Date(e.reservation_date),s=C?new Date(C+"T00:00:00"):null,l=P?new Date(P+"T23:59:59"):null;return a&&r&&(!s||n>=s)&&(!l||n<=l)}),formatDate=e=>new Date(e).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}),formatTime=e=>e,getStatusInfo=e=>{if("CANCELLED"===e.status)return{color:"bg-orange-100 text-orange-800",text:"Dibatalkan"};if("REJECTED"===e.status)return{color:"bg-red-100 text-red-800",text:"Ditolak Admin"};if("FULL"===e.payment_type)return"PENDING"===e.payment_status?{color:"bg-yellow-100 text-yellow-800",text:"Menunggu Validasi"}:"PAID"===e.payment_status?{color:"bg-green-100 text-green-800",text:"Lunas"}:{color:"bg-gray-100 text-gray-800",text:"Menunggu Validasi"};let t=e.payment_status;switch(t){case"PENDING":return{color:"bg-yellow-100 text-yellow-800",text:"Menunggu Validasi DP"};case"DP_SENT":return{color:"bg-blue-100 text-blue-800",text:"DP Terkirim"};case"DP_PAID":return{color:"bg-blue-200 text-blue-900",text:"DP Terbayar"};case"DP_REJECTED":return{color:"bg-red-100 text-red-800",text:"DP Ditolak"};case"PELUNASAN_SENT":return{color:"bg-purple-100 text-purple-800",text:"Pelunasan Terkirim"};case"PELUNASAN_REJECTED":return{color:"bg-red-100 text-red-800",text:"Pelunasan Ditolak"};case"PELUNASAN_PAID":case"PAID":return{color:"bg-green-100 text-green-800",text:"Lunas"};case"REFUNDED":return{color:"bg-red-100 text-red-800",text:"Dikembalikan"};default:return{color:"bg-gray-100 text-gray-800",text:t}}},$=[{value:"ALL",label:"Semua Status"},{value:"PENDING",label:"Menunggu"},{value:"DP_SENT",label:"DP Terkirim"},{value:"DP_PAID",label:"DP Terbayar"},{value:"DP_REJECTED",label:"DP Ditolak"},{value:"PELUNASAN_SENT",label:"Pelunasan Terkirim"},{value:"PELUNASAN_REJECTED",label:"Pelunasan Ditolak"},{value:"PELUNASAN_PAID",label:"Pelunasan Terbayar"},{value:"REJECTED",label:"Ditolak Admin"},{value:"CANCELLED",label:"Dibatalkan"},{value:"COMPLETED",label:"Lunas"}];return b||!t?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Memuat data..."})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(l.Z,{isOpen:w,setIsOpen:N}),(0,r.jsxs)("div",{className:"lg:ml-64",children:[(0,r.jsx)(i.Z,{title:"Manajemen Booking",onMenuClick:()=>N(!0)}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("div",{className:"mb-6 bg-white border border-gray-200 rounded-lg shadow-sm p-4",children:(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4 lg:items-center",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(o.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,r.jsx)("input",{type:"text",placeholder:"Cari booking...",value:D,onChange:e=>k(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm"})]})}),(0,r.jsxs)("div",{ref:Q,className:"relative w-full sm:w-56",children:[(0,r.jsxs)("button",{onClick:()=>G(!W),className:"flex items-center justify-between w-full px-4 h-10 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500 transition",children:[(0,r.jsx)("span",{className:"text-sm text-gray-700",children:null===(e=$.find(e=>e.value===S))||void 0===e?void 0:e.label}),(0,r.jsx)(d.Z,{className:"w-5 h-5 text-gray-400 transition-transform ".concat(W?"rotate-180":"")})]}),(0,r.jsx)("div",{className:"absolute z-10 w-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg transform transition-all duration-200 ".concat(W?"opacity-100 translate-y-0":"opacity-0 -translate-y-2 pointer-events-none"),children:$.map(e=>(0,r.jsx)("button",{onClick:()=>{_(e.value),G(!1)},className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-100 first:rounded-t-lg last:rounded-b-lg ".concat(S===e.value?"bg-primary-50 text-primary-700":"text-gray-700"),children:e.label},e.value))})]}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"date",value:C,onChange:e=>T(e.target.value),className:"h-10 px-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm text-gray-700"}),(0,r.jsx)("span",{className:"text-gray-500 text-sm",children:"–"}),(0,r.jsx)("input",{type:"date",value:P,onChange:e=>E(e.target.value),className:"h-10 px-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm text-gray-700"})]}),(0,r.jsx)("button",{type:"button",onClick:()=>{T(""),E("")},className:"h-10 px-4 text-sm text-gray-700 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-100 focus:ring-2 focus:ring-primary-500 transition",children:"Clear"})]})]})}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-y-3 pl-4 pr-6 py-4 border-b border-gray-200 bg-white",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"p-2 rounded-lg flex items-center justify-center",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor",viewBox:"0 0 16 16",className:"text-gray-800",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M0 .5A.5.5 0 0 1 .5 0h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 0 .5m13 0a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m-13 2A.5.5 0 0 1 .5 2h8a.5.5 0 0 1 0 1h-8a.5.5 0 0 1-.5-.5m13 0a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m-13 2A.5.5 0 0 1 .5 4h10a.5.5 0 0 1 0 1H.5a.5.5 0 0 1-.5-.5m13 0a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m-13 2A.5.5 0 0 1 .5 6h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m13 0a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m-13 2A.5.5 0 0 1 .5 8h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m13 0a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m-13 2a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m13 0a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m-13 2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5m13 0a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m-13 2a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H.5a.5.5 0 0 1-.5-.5m13 0a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5"})})}),(0,r.jsx)("h2",{className:"ml-3 text-lg font-semibold text-gray-800",children:"Daftar Booking"})]}),(0,r.jsxs)("button",{onClick:()=>{let e=h.filter(e=>{let t="COMPLETED"===e.status,a="DP_PAID"===e.status,r="CANCELLED"===e.status&&"PENDING"!==e.payment_status;if(C||P){let t=new Date(e.reservation_date),a=C?new Date(C+"T00:00:00"):null,r=P?new Date(P+"T23:59:59"):null;if(!((!a||t>=a)&&(!r||t<=r)))return!1}return t||a||r}).sort((e,t)=>{let a=new Date("".concat(e.reservation_date," ").concat(e.start_time)).getTime(),r=new Date("".concat(t.reservation_date," ").concat(t.start_time)).getTime();return a-r});if(0===e.length){alert("Tidak ada booking untuk diekspor.");return}let t=e.reduce((e,t)=>{let a=t.total_price;return"CANCELLED"===t.status&&(a=t.total_price/2),e+a},0),a=e.filter(e=>"COMPLETED"===e.status),r=a.reduce((e,t)=>{let a=new Date("1970-01-01T".concat(t.start_time)),r=new Date("1970-01-01T".concat(t.end_time)),n=(r.getTime()-a.getTime())/36e5;return e+n},0),n={};a.forEach(e=>{let t=new Date("1970-01-01T".concat(e.start_time)),a=new Date("1970-01-01T".concat(e.end_time)),r=(a.getTime()-t.getTime())/36e5;n[e.field_name]=(n[e.field_name]||0)+r}),Array.from(new Set(h.map(e=>e.field_name))).sort();let s=C?new Date(C).toLocaleDateString("id-ID"):"-",l=P?new Date(P).toLocaleDateString("id-ID"):"-",i=new j.ZP({orientation:"portrait",unit:"mm",format:"a4"});i.setFont("helvetica","bold"),i.setFontSize(18),i.text("GOR Puri Beta",105,20,{align:"center"}),i.setFontSize(13),i.text("Rekap Pendapatan",105,27,{align:"center"}),i.setFontSize(11),i.setFont("helvetica","normal"),i.text("Periode: ".concat(s," s/d ").concat(l),105,34,{align:"center"}),i.setDrawColor(0),i.setLineWidth(.4),i.line(20,38,190,38);let o=e.map((e,t)=>{let a=e.total_price,r="Lunas";return"CANCELLED"===e.status?(a=e.total_price/2,r="DP"===e.payment_type?"DP (Cancelled)":"Lunas (Cancelled)"):"DP"===e.payment_type?"DP_PAID"===e.payment_status?r="DP Terbayar":"PAID"===e.payment_status&&(r="Lunas"):r="Lunas",[t+1,new Date(e.reservation_date).toLocaleDateString("id-ID"),e.user.name,e.field_name,"".concat(e.start_time," - ").concat(e.end_time),r,"Rp ".concat(a.toLocaleString("id-ID"))]}),d=o.length;o.push(["","","","","Total Pemasukan:","","Rp ".concat(t.toLocaleString("id-ID"))],["","","","","Total Jam Tersewa:","","".concat(r," jam")]),(0,v.ZP)(i,{startY:45,head:[["No","Tanggal","Customer","Lapangan","Jam Main","Status","Total"]],body:o,theme:"plain",styles:{fontSize:9,cellPadding:{top:2.5,right:2,bottom:2.5,left:2},valign:"middle",lineColor:[0,0,0],lineWidth:.2,textColor:[0,0,0]},headStyles:{fontStyle:"bold",halign:"center",lineWidth:.3,textColor:[0,0,0],fillColor:[240,240,240]},columnStyles:{0:{halign:"center",cellWidth:8},1:{halign:"center",cellWidth:23},2:{halign:"left",cellWidth:38},3:{halign:"left",cellWidth:28},4:{halign:"center",cellWidth:25},5:{halign:"center",cellWidth:20},6:{halign:"right",cellWidth:28}},margin:{left:20,right:20},didParseCell:e=>{(e.row.index===d||e.row.index===d+1)&&(e.cell.styles.lineWidth=0,e.cell.styles.fontStyle="bold")}});let c=i.internal.pageSize.height;i.setFontSize(9),i.setTextColor(80),i.text("Dibuat pada: ".concat(new Date().toLocaleString("id-ID")),20,c-10),i.text("Sistem Manajemen Booking Lapangan",190,c-10,{align:"right"}),i.save("Rekap_Pendapatan_".concat(s,"_").concat(l,".pdf"))},className:"inline-flex items-center justify-center px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-lg shadow-sm hover:bg-red-700 transition mr-2 sm:mr-4",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4 mr-2"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Export PDF"}),(0,r.jsx)("span",{className:"sm:hidden",children:"PDF"})]})]}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Lapangan"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tanggal"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Jam"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),(0,r.jsx)("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"TIPE"}),(0,r.jsx)("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status Reservasi"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aksi"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===X.length?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:8,className:"px-6 py-12 text-center text-gray-500",children:"Tidak ada data booking"})}):X.map(e=>(getStatusInfo(e),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{children:(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.field_name})})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.user.name}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:e.user.phone||"No phone"})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:formatDate(e.reservation_date)}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[formatTime(e.start_time)," - ",formatTime(e.end_time)]}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["Rp ",e.total_price.toLocaleString("id-ID")]}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-center align-middle",children:(0,r.jsx)("span",{className:"inline-flex items-center justify-center px-3 py-1 rounded-full text-xs font-medium ".concat("DP"===e.payment_type?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:"DP"===e.payment_type?"DP":"Lunas"})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-center align-middle",children:(0,r.jsx)("span",{className:"inline-flex items-center justify-center px-3 py-1 rounded-full text-xs font-medium ".concat(getStatusInfo(e).color),children:getStatusInfo(e).text})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("button",{onClick:()=>handleShowDetail(e),className:"inline-flex items-center px-3 py-1 rounded-md text-xs font-medium ".concat("DP_PAID"===e.status?"bg-green-100 text-green-800 hover:bg-green-200":"bg-gray-100 text-gray-800 hover:bg-gray-200"),children:[(0,r.jsx)(m.Z,{className:"w-3 h-3 mr-1"}),"Detail"]}),"CANCELLED"!==e.status&&"REJECTED"!==e.status&&(0,r.jsxs)("button",{onClick:()=>handleShowReschedule(e),className:"inline-flex items-center px-3 py-1 rounded-md text-xs font-medium bg-blue-100 text-blue-800 hover:bg-blue-200",title:"Reschedule booking",children:[(0,r.jsx)(u.Z,{className:"w-3 h-3 mr-1"}),"Reschedule"]})]})})]},e.id)))})]})})]})]})]}),I&&(0,r.jsx)(x.Z,{reservation:I,isOpen:M,onClose:()=>{B(!1),R(null)},onPaymentStatusUpdate:handlePaymentStatusUpdate,onDelete:fetchReservations}),F&&U&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[100] p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg max-w-5xl max-h-[90vh] overflow-hidden shadow-2xl",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-4 border-b bg-gray-50",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Bukti Pembayaran"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Klik download untuk menyimpan file"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("a",{href:U,download:"bukti-pembayaran-".concat(Date.now(),".jpg"),className:"flex items-center space-x-1 px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"Download"})]}),(0,r.jsx)("button",{onClick:()=>{J(!1),Z(null),z(null)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,r.jsx)(g.Z,{className:"w-6 h-6"})})]})]}),(0,r.jsx)("div",{className:"p-4 bg-gray-50",children:(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)("img",{src:U,alt:"Bukti Pembayaran",className:"max-w-full max-h-[70vh] object-contain mx-auto rounded-lg shadow-lg"})})})]})}),K&&(0,r.jsx)(RescheduleModal,{isOpen:H,onClose:()=>{Y(!1),V(null)},reservation:K,onSuccess:()=>{fetchReservations()}})]})}}},function(e){e.O(0,[461,125,505,176,677,466,971,472,744],function(){return e(e.s=5545)}),_N_E=e.O()}]);