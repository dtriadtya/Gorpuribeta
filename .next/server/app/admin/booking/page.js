(()=>{var e={};e.id=5729,e.ids=[5729],e.modules={55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},98188:e=>{"use strict";e.exports=require("module")},57310:e=>{"use strict";e.exports=require("url")},11468:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>g,tree:()=>d});var r=a(67096),s=a(16132),n=a(37284),l=a.n(n),i=a(32564),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);a.d(t,o);let d=["",{children:["admin",{children:["booking",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,9101)),"C:\\Projects\\backup 07-11-2025 4.11\\gorpuribeta-main\\app\\admin\\booking\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,29925)),"C:\\Projects\\backup 07-11-2025 4.11\\gorpuribeta-main\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,9291,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Projects\\backup 07-11-2025 4.11\\gorpuribeta-main\\app\\admin\\booking\\page.tsx"],m="/admin/booking/page",u={require:a,loadChunk:()=>Promise.resolve()},g=new r.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/admin/booking/page",pathname:"/admin/booking",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},17167:(e,t,a)=>{Promise.resolve().then(a.bind(a,68308))},68308:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>BookingManagement});var r=a(30784),s=a(9885),n=a(57114),l=a(11635),i=a(81384),o=a(69518),d=a(19458),c=a(85574),m=a(28626),u=a(517),g=a(56206),x=a(12039),h=a(15441),p=a(79803),b=a(37631),y=a(19300);function RescheduleModal({isOpen:e,onClose:t,reservation:a,onSuccess:n}){let[l,i]=(0,s.useState)(""),[o,d]=(0,s.useState)([]),[c,m]=(0,s.useState)(""),[x,f]=(0,s.useState)(!1),[j,w]=(0,s.useState)(new Date),[v,N]=(0,s.useState)(!0),[D,k]=(0,s.useState)([]),formatDate=e=>{let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${r}`},parseDateString=e=>{let[t,a,r]=e.split("-").map(Number);return new Date(t,a-1,r)},isToday=e=>e.toDateString()===new Date().toDateString(),isPast=e=>{let t=new Date;return t.setHours(0,0,0,0),e<t};(0,s.useEffect)(()=>{e&&a.field_id&&(fetchScheduleData(a.field_id),i(""),d([]),m(""),N(!0))},[e,a]),(0,s.useEffect)(()=>{if(!e||!a.field_id)return;let t=setInterval(()=>{fetchScheduleData(a.field_id)},2e3);return()=>clearInterval(t)},[e,a.field_id]);let fetchScheduleData=async e=>{try{let t=await fetch(`/api/schedule?fieldId=${e}&t=${Date.now()}`);if(t.ok){let e=await t.json();k(e.schedule)}}catch(e){console.error("Error fetching schedule:",e)}},handleDateSelect=e=>{!e||isPast(e)||(i(formatDate(e)),d([]),N(!1))},getTimeSlotsForDate=e=>{let t=formatDate(e),a=D.find(e=>e.date===t),r=[];for(let t=8;t<22;t++){let s=`${t.toString().padStart(2,"0")}:00`,n=a?.timeSlots.find(e=>e.time===s);if(n)r.push(n);else{let a=isToday(e)&&t<new Date().getHours();r.push({time:s,available:!a,status:a?"booked":"available"})}}return r},handleTimeSlotClick=e=>{if(0===o.length){d([e]);return}if(o.includes(e)){d([]);return}let t=getTimeSlotsForDate(parseDateString(l)),a=o[0],r=t.findIndex(e=>e.time===a),s=t.findIndex(t=>t.time===e);if(-1===r||-1===s)return;let n=Math.min(r,s),i=Math.max(r,s),c=[];for(let e=n;e<=i;e++){if(!t[e].available)return;c.push(t[e].time)}d(c)},handleSubmit=async e=>{if(e.preventDefault(),!l||0===o.length){y.Z.fire({icon:"warning",title:"Data Tidak Lengkap",text:"Harap pilih tanggal dan waktu untuk reschedule",confirmButtonColor:"#2563eb"});return}let r=o[0],s=o[o.length-1],i=parseInt(s.split(":")[0])+1,d=`${i.toString().padStart(2,"0")}:00`;f(!0);try{let e=localStorage.getItem("token"),s=await fetch(`/api/reservations/${a.id}/reschedule`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({newDate:l,newStartTime:r,newEndTime:d,adminNotes:`Reschedule dari ${a.reservation_date} ${a.start_time}-${a.end_time}`})}),i=await s.json();s.ok?(y.Z.fire({icon:"success",title:"Berhasil!",text:"Booking berhasil di-reschedule",confirmButtonColor:"#2563eb",timer:2e3}),n(),t()):y.Z.fire({icon:"error",title:"Gagal",text:i.error||"Gagal melakukan reschedule",confirmButtonColor:"#2563eb"})}catch(e){console.error("Error rescheduling:",e),y.Z.fire({icon:"error",title:"Error",text:"Terjadi kesalahan saat melakukan reschedule",confirmButtonColor:"#2563eb"})}finally{f(!1)}};if(!e)return null;let S=(()=>{let e=j.getFullYear(),t=j.getMonth(),a=new Date(e,t,1),r=new Date(e,t+1,0),s=a.getDay(),n=r.getDate(),l=Array(s).fill(null);for(let a=1;a<=n;a++)l.push(new Date(e,t,a));return l})(),_=l?getTimeSlotsForDate(parseDateString(l)):[];return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-xl flex justify-between items-center z-10",children:[(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"text-2xl font-bold",children:"Reschedule Booking"}),(0,r.jsxs)("p",{className:"text-blue-100 text-sm mt-1",children:[a.field_name," - ",a.user.name]})]}),r.jsx("button",{onClick:t,className:"text-white hover:bg-white/20 rounded-lg p-2 transition",children:r.jsx(g.Z,{className:"w-6 h-6"})})]}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[r.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Jadwal Saat Ini:"}),(0,r.jsxs)("div",{className:"text-sm text-blue-800 space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(u.Z,{className:"w-4 h-4"}),r.jsx("span",{children:new Date(a.reservation_date).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(h.Z,{className:"w-4 h-4"}),(0,r.jsxs)("span",{children:[a.start_time," - ",a.end_time]})]})]})]}),(0,r.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:v?"Pilih Tanggal Baru":"Pilih Waktu Baru"}),!v&&(0,r.jsxs)("button",{type:"button",onClick:()=>N(!0),className:"px-3 py-1 text-sm bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200",children:[r.jsx(u.Z,{className:"w-4 h-4 inline mr-1"})," Ubah Tanggal"]})]}),v&&(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("button",{type:"button",onClick:()=>{let e=new Date(j);e.setMonth(e.getMonth()-1);let t=new Date;e.getFullYear()<t.getFullYear()||e.getFullYear()===t.getFullYear()&&e.getMonth()<t.getMonth()||w(e)},className:"p-2 hover:bg-gray-100 rounded-lg",children:r.jsx(p.Z,{className:"w-5 h-5"})}),r.jsx("h4",{className:"text-base font-semibold text-gray-900",children:j.toLocaleDateString("id-ID",{month:"long",year:"numeric"})}),r.jsx("button",{type:"button",onClick:()=>{let e=new Date(j);e.setMonth(e.getMonth()+1),w(e)},className:"p-2 hover:bg-gray-100 rounded-lg",children:r.jsx(b.Z,{className:"w-5 h-5"})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-7 gap-2",children:[["Min","Sen","Sel","Rab","Kam","Jum","Sab"].map(e=>r.jsx("div",{className:"text-center text-sm font-medium text-gray-500 py-2",children:e},e)),S.map((e,t)=>{if(!e)return r.jsx("div",{className:"p-3"},`empty-${t}`);let a=formatDate(e),s=D.find(e=>e.date===a),n=s?s.timeSlots.filter(e=>"booked"===e.status).length:0,i=n>=14,o=isPast(e)||i,d=l===a,c=isToday(e);return r.jsx("button",{type:"button",onClick:()=>handleDateSelect(e),disabled:o,className:`
                            p-3 rounded-lg text-sm font-medium transition-all
                            ${d?"bg-primary-600 text-white ring-2 ring-primary-300":i?"bg-red-100 text-red-500 cursor-not-allowed border border-red-200":o?"bg-gray-100 text-gray-300 cursor-not-allowed":c?"bg-blue-50 text-blue-600 border-2 border-blue-300 hover:bg-blue-100":"bg-gray-50 text-gray-700 hover:bg-gray-100 hover:ring-2 hover:ring-gray-200"}
                          `,children:r.jsx("div",{children:e.getDate()})},t)})]}),r.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:(0,r.jsxs)("p",{className:"text-sm text-blue-800",children:["\uD83D\uDCA1 ",r.jsx("strong",{children:"Tips:"})," Pilih tanggal pada kalender untuk melihat slot waktu yang tersedia"]})})]}),!v&&l&&(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:["Pilih Waktu - ",parseDateString(l).toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"})]}),r.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Klik waktu mulai, lalu klik waktu akhir untuk memilih range. Contoh ingin reschedule 2 jam maka klik 08:00 dan 09:00 dst."}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 text-xs",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[r.jsx("div",{className:"w-3 h-3 bg-gray-50 border border-gray-200 rounded"}),r.jsx("span",{className:"text-gray-600",children:"Tersedia"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[r.jsx("div",{className:"w-3 h-3 bg-primary-600 rounded"}),r.jsx("span",{className:"text-gray-600",children:"Terpilih"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[r.jsx("div",{className:"w-3 h-3 bg-red-100 border border-red-200 rounded"}),r.jsx("span",{className:"text-gray-600",children:"Terbooking"})]})]})]}),r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3",children:_.map(e=>{let t=o.includes(e.time),a=o[0]===e.time,s=o[o.length-1]===e.time,n=o.length>1&&t&&!a&&!s;return(0,r.jsxs)("button",{type:"button",onClick:()=>handleTimeSlotClick(e.time),disabled:!e.available||"booked"===e.status,className:`
                            p-2 sm:p-3 rounded-lg text-[11px] sm:text-sm font-medium transition-colors
                            ${t?"bg-primary-600 text-white":"booked"===e.status?"bg-red-100 text-red-600 border border-red-200 cursor-not-allowed":e.available?"bg-gray-50 text-gray-700 hover:bg-gray-100 border border-gray-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}
                            ${a&&o.length>1?"rounded-l-lg":""}
                            ${s&&o.length>1?"rounded-r-lg":""}
                            ${n?"rounded-none":""}
                          `,children:[(0,r.jsxs)("div",{children:[e.time," - ",String(parseInt(e.time.split(":")[0])+1).padStart(2,"0"),":00"]}),r.jsx("div",{className:"text-[9px] sm:text-xs opacity-75 mt-0.5",children:"booked"===e.status?"Terbooking":"Tersedia"})]},e.time)})})]})]}),l&&o.length>0&&(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[r.jsx("h3",{className:"font-semibold text-blue-900 mb-3",children:"Ringkasan Reschedule:"}),(0,r.jsxs)("div",{className:"space-y-2 text-sm text-blue-800",children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-blue-600",children:"Tanggal:"})," ",r.jsx("span",{className:"font-medium",children:parseDateString(l).toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"})})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-blue-600",children:"Waktu:"})," ",(0,r.jsxs)("span",{className:"font-medium",children:[o[0]," - ",(()=>{let e=o[o.length-1],t=parseInt(e.split(":")[0])+1;return`${t.toString().padStart(2,"0")}:00`})()]})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-blue-600",children:"Durasi:"})," ",(0,r.jsxs)("span",{className:"font-medium",children:[o.length," jam"]})]})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Catatan Admin (Opsional)"}),r.jsx("textarea",{value:c,onChange:e=>m(e.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Tambahkan catatan untuk reschedule ini..."})]}),r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,r.jsxs)("p",{className:"text-sm text-yellow-800",children:[r.jsx("strong",{children:"⚠️ Perhatian:"})," Pastikan jadwal baru tidak bentrok dengan booking lain. User akan menerima notifikasi perubahan jadwal."]})}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4",children:[r.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition",disabled:x,children:"Batal"}),r.jsx("button",{type:"submit",className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition disabled:opacity-50 disabled:cursor-not-allowed",disabled:x,children:x?"Memproses...":"Simpan"})]})]})]})]})})}var f=a(78335),j=a(73059);function BookingManagement(){let[e,t]=(0,s.useState)(null),[a,h]=(0,s.useState)([]),[p,b]=(0,s.useState)(!0),[w,v]=(0,s.useState)(!1),[N,D]=(0,s.useState)(""),[k,S]=(0,s.useState)("ALL"),[_,P]=(0,s.useState)(""),[C,T]=(0,s.useState)(""),[E,L]=(0,s.useState)(""),[A,I]=(0,s.useState)(null),[$,R]=(0,s.useState)(!1),[M,B]=(0,s.useState)(!1),[Z,F]=(0,s.useState)(null),[J,U]=(0,s.useState)(null),[O,z]=(0,s.useState)(!1),[G,W]=(0,s.useState)(!1),[q,H]=(0,s.useState)(null),Y=(0,n.useRouter)();(0,s.useEffect)(()=>{let e=localStorage.getItem("token"),a=localStorage.getItem("user");if(console.log("Booking page auth check:",{token:!!e,userData:!!a}),!e||!a){console.log("No token or user data, redirecting to login"),window.location.replace("/login");return}try{let e=JSON.parse(a);if(console.log("Parsed user:",e),"ADMIN"!==e.role){console.log("User is not admin, redirecting to home"),window.location.replace("/");return}t(e),fetchReservations()}catch(e){console.error("Error parsing user data:",e),localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.replace("/login")}},[]),(0,s.useEffect)(()=>{let e=setInterval(()=>{fetchReservations()},5e3);return()=>clearInterval(e)},[]);let K=(0,s.useRef)(null);(0,s.useEffect)(()=>{let handleClickOutside=e=>{K.current&&!K.current.contains(e.target)&&z(!1)};return document.addEventListener("mousedown",handleClickOutside),()=>{document.removeEventListener("mousedown",handleClickOutside)}},[]);let fetchReservations=async()=>{try{let e=localStorage.getItem("token"),t={};e&&(t.Authorization=`Bearer ${e}`);let a=await fetch("/api/admin/reservations",{headers:t});if(401===a.status){console.log("❌ Unauthorized - redirecting to login"),Y.push("/login");return}if(a.ok){let e=await a.json(),t=(e.reservations||[]).sort((e,t)=>new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime()),r=t.map(e=>({...e,payment_type:e.payment_type||"FULL",payment_amount:"number"!=typeof e.payment_amount||isNaN(e.payment_amount)?e.total_price:e.payment_amount,payment_validated_by:e.payment_validated_by??null,payment_validated_at:e.payment_validated_at??null,payment_validated_admin:e.payment_validated_admin??null}));h(r)}}catch(e){console.error("Error fetching reservations:",e)}finally{b(!1)}},handlePaymentStatusUpdate=async(e,t,a)=>{if("REJECT_PELUNASAN"===t||"REJECT_DP"===t||"REJECT_FULL"===t){fetchReservations(),R(!1),I(null);return}try{let r=localStorage.getItem("token");if(!r){y.Z.fire({icon:"error",title:"Tidak ada sesi",text:"Silakan login ulang sebagai admin",confirmButtonColor:"#2563eb"});return}let s=await fetch(`/api/reservations/${e}/payment`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({paymentStatus:t,adminNotes:a})});if(s.ok)fetchReservations(),y.Z.fire({icon:"success",title:"Berhasil!",text:"Status pembayaran berhasil diperbarui",confirmButtonColor:"#2563eb",timer:2e3}),R(!1),I(null);else{let e=await s.json();if(401===s.status){y.Z.fire({icon:"error",title:"Tidak Terotorisasi",text:"Sesi admin tidak valid. Login ulang diperlukan.",confirmButtonColor:"#2563eb"});return}y.Z.fire({icon:"error",title:"Gagal",text:e.error||"Gagal memperbarui status pembayaran",confirmButtonColor:"#2563eb"})}}catch(e){console.error("Error updating payment status:",e),y.Z.fire({icon:"error",title:"Gagal",text:"Terjadi kesalahan saat memperbarui status pembayaran",confirmButtonColor:"#2563eb"})}},handleShowDetail=e=>{I(e),R(!0)},handleShowReschedule=e=>{H(e),W(!0)},V=a.filter(e=>{let t=e.user.name.toLowerCase().includes(N.toLowerCase())||e.field_name.toLowerCase().includes(N.toLowerCase())||e.user.phone?.includes(N),a="ALL"===k||e.status===k,r=new Date(e.reservation_date),s=_?new Date(_+"T00:00:00"):null,n=C?new Date(C+"T23:59:59"):null;return t&&a&&(!s||r>=s)&&(!n||r<=n)}),formatDate=e=>new Date(e).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}),formatTime=e=>e,getStatusInfo=e=>{if("CANCELLED"===e.status)return{color:"bg-orange-100 text-orange-800",text:"Dibatalkan"};if("REJECTED"===e.status)return{color:"bg-red-100 text-red-800",text:"Ditolak Admin"};if("FULL"===e.payment_type)return"PENDING"===e.payment_status?{color:"bg-yellow-100 text-yellow-800",text:"Menunggu Validasi"}:"PAID"===e.payment_status?{color:"bg-green-100 text-green-800",text:"Lunas"}:{color:"bg-gray-100 text-gray-800",text:"Menunggu Validasi"};let t=e.payment_status;switch(t){case"PENDING":return{color:"bg-yellow-100 text-yellow-800",text:"Menunggu Validasi DP"};case"DP_SENT":return{color:"bg-blue-100 text-blue-800",text:"DP Terkirim"};case"DP_PAID":return{color:"bg-blue-200 text-blue-900",text:"DP Terbayar"};case"DP_REJECTED":return{color:"bg-red-100 text-red-800",text:"DP Ditolak"};case"PELUNASAN_SENT":return{color:"bg-purple-100 text-purple-800",text:"Pelunasan Terkirim"};case"PELUNASAN_REJECTED":return{color:"bg-red-100 text-red-800",text:"Pelunasan Ditolak"};case"PELUNASAN_PAID":case"PAID":return{color:"bg-green-100 text-green-800",text:"Lunas"};case"REFUNDED":return{color:"bg-red-100 text-red-800",text:"Dikembalikan"};default:return{color:"bg-gray-100 text-gray-800",text:t}}},X=[{value:"ALL",label:"Semua Status"},{value:"PENDING",label:"Menunggu"},{value:"DP_SENT",label:"DP Terkirim"},{value:"DP_PAID",label:"DP Terbayar"},{value:"DP_REJECTED",label:"DP Ditolak"},{value:"PELUNASAN_SENT",label:"Pelunasan Terkirim"},{value:"PELUNASAN_REJECTED",label:"Pelunasan Ditolak"},{value:"PELUNASAN_PAID",label:"Pelunasan Terbayar"},{value:"REJECTED",label:"Ditolak Admin"},{value:"CANCELLED",label:"Dibatalkan"},{value:"COMPLETED",label:"Lunas"}];return p||!e?r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"Memuat data..."})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx(l.Z,{isOpen:w,setIsOpen:v}),(0,r.jsxs)("div",{className:"lg:ml-64",children:[r.jsx(i.Z,{title:"Manajemen Booking",onMenuClick:()=>v(!0)}),(0,r.jsxs)("div",{className:"p-6",children:[r.jsx("div",{className:"mb-6 bg-white border border-gray-200 rounded-lg shadow-sm p-4",children:(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4 lg:items-center",children:[r.jsx("div",{className:"flex-1",children:(0,r.jsxs)("div",{className:"relative",children:[r.jsx(o.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),r.jsx("input",{type:"text",placeholder:"Cari booking...",value:N,onChange:e=>D(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm"})]})}),(0,r.jsxs)("div",{ref:K,className:"relative w-full sm:w-56",children:[(0,r.jsxs)("button",{onClick:()=>z(!O),className:"flex items-center justify-between w-full px-4 h-10 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500 transition",children:[r.jsx("span",{className:"text-sm text-gray-700",children:X.find(e=>e.value===k)?.label}),r.jsx(d.Z,{className:`w-5 h-5 text-gray-400 transition-transform ${O?"rotate-180":""}`})]}),r.jsx("div",{className:`absolute z-10 w-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg transform transition-all duration-200 ${O?"opacity-100 translate-y-0":"opacity-0 -translate-y-2 pointer-events-none"}`,children:X.map(e=>r.jsx("button",{onClick:()=>{S(e.value),z(!1)},className:`w-full text-left px-4 py-2 text-sm hover:bg-gray-100 first:rounded-t-lg last:rounded-b-lg ${k===e.value?"bg-primary-50 text-primary-700":"text-gray-700"}`,children:e.label},e.value))})]}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"date",value:_,onChange:e=>P(e.target.value),className:"h-10 px-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm text-gray-700"}),r.jsx("span",{className:"text-gray-500 text-sm",children:"–"}),r.jsx("input",{type:"date",value:C,onChange:e=>T(e.target.value),className:"h-10 px-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm text-gray-700"})]}),r.jsx("button",{type:"button",onClick:()=>{P(""),T("")},className:"h-10 px-4 text-sm text-gray-700 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-100 focus:ring-2 focus:ring-primary-500 transition",children:"Clear"})]})]})}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-y-3 pl-4 pr-6 py-4 border-b border-gray-200 bg-white",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-2 rounded-lg flex items-center justify-center",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor",viewBox:"0 0 16 16",className:"text-gray-800",children:r.jsx("path",{fillRule:"evenodd",d:"M0 .5A.5.5 0 0 1 .5 0h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 0 .5m13 0a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m-13 2A.5.5 0 0 1 .5 2h8a.5.5 0 0 1 0 1h-8a.5.5 0 0 1-.5-.5m13 0a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m-13 2A.5.5 0 0 1 .5 4h10a.5.5 0 0 1 0 1H.5a.5.5 0 0 1-.5-.5m13 0a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m-13 2A.5.5 0 0 1 .5 6h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m13 0a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m-13 2A.5.5 0 0 1 .5 8h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m13 0a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m-13 2a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m13 0a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m-13 2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5m13 0a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m-13 2a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H.5a.5.5 0 0 1-.5-.5m13 0a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5"})})}),r.jsx("h2",{className:"ml-3 text-lg font-semibold text-gray-800",children:"Daftar Booking"})]}),(0,r.jsxs)("button",{onClick:()=>{let e=a.filter(e=>{let t="COMPLETED"===e.status,a="DP_PAID"===e.status,r="CANCELLED"===e.status&&"PENDING"!==e.payment_status;if(_||C){let t=new Date(e.reservation_date),a=_?new Date(_+"T00:00:00"):null,r=C?new Date(C+"T23:59:59"):null;if(!((!a||t>=a)&&(!r||t<=r)))return!1}return t||a||r}).sort((e,t)=>{let a=new Date(`${e.reservation_date} ${e.start_time}`).getTime(),r=new Date(`${t.reservation_date} ${t.start_time}`).getTime();return a-r});if(0===e.length){alert("Tidak ada booking untuk diekspor.");return}let t=e.reduce((e,t)=>{let a=t.total_price;return"CANCELLED"===t.status&&(a=t.total_price/2),e+a},0),r=e.filter(e=>"COMPLETED"===e.status),s=r.reduce((e,t)=>{let a=new Date(`1970-01-01T${t.start_time}`),r=new Date(`1970-01-01T${t.end_time}`),s=(r.getTime()-a.getTime())/36e5;return e+s},0),n={};r.forEach(e=>{let t=new Date(`1970-01-01T${e.start_time}`),a=new Date(`1970-01-01T${e.end_time}`),r=(a.getTime()-t.getTime())/36e5;n[e.field_name]=(n[e.field_name]||0)+r}),Array.from(new Set(a.map(e=>e.field_name))).sort();let l=_?new Date(_).toLocaleDateString("id-ID"):"-",i=C?new Date(C).toLocaleDateString("id-ID"):"-",o=new f.ZP({orientation:"portrait",unit:"mm",format:"a4"});o.setFont("helvetica","bold"),o.setFontSize(18),o.text("GOR Puri Beta",105,20,{align:"center"}),o.setFontSize(13),o.text("Rekap Pendapatan",105,27,{align:"center"}),o.setFontSize(11),o.setFont("helvetica","normal"),o.text(`Periode: ${l} s/d ${i}`,105,34,{align:"center"}),o.setDrawColor(0),o.setLineWidth(.4),o.line(20,38,190,38);let d=e.map((e,t)=>{let a=e.total_price,r="Lunas";return"CANCELLED"===e.status?(a=e.total_price/2,r="DP"===e.payment_type?"DP (Cancelled)":"Lunas (Cancelled)"):"DP"===e.payment_type?"DP_PAID"===e.payment_status?r="DP Terbayar":"PAID"===e.payment_status&&(r="Lunas"):r="Lunas",[t+1,new Date(e.reservation_date).toLocaleDateString("id-ID"),e.user.name,e.field_name,`${e.start_time} - ${e.end_time}`,r,`Rp ${a.toLocaleString("id-ID")}`]}),c=d.length;d.push(["","","","","Total Pemasukan:","",`Rp ${t.toLocaleString("id-ID")}`],["","","","","Total Jam Tersewa:","",`${s} jam`]),(0,j.ZP)(o,{startY:45,head:[["No","Tanggal","Customer","Lapangan","Jam Main","Status","Total"]],body:d,theme:"plain",styles:{fontSize:9,cellPadding:{top:2.5,right:2,bottom:2.5,left:2},valign:"middle",lineColor:[0,0,0],lineWidth:.2,textColor:[0,0,0]},headStyles:{fontStyle:"bold",halign:"center",lineWidth:.3,textColor:[0,0,0],fillColor:[240,240,240]},columnStyles:{0:{halign:"center",cellWidth:8},1:{halign:"center",cellWidth:23},2:{halign:"left",cellWidth:38},3:{halign:"left",cellWidth:28},4:{halign:"center",cellWidth:25},5:{halign:"center",cellWidth:20},6:{halign:"right",cellWidth:28}},margin:{left:20,right:20},didParseCell:e=>{(e.row.index===c||e.row.index===c+1)&&(e.cell.styles.lineWidth=0,e.cell.styles.fontStyle="bold")}});let m=o.internal.pageSize.height;o.setFontSize(9),o.setTextColor(80),o.text(`Dibuat pada: ${new Date().toLocaleString("id-ID")}`,20,m-10),o.text("Sistem Manajemen Booking Lapangan",190,m-10,{align:"right"}),o.save(`Rekap_Pendapatan_${l}_${i}.pdf`)},className:"inline-flex items-center justify-center px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-lg shadow-sm hover:bg-red-700 transition mr-2 sm:mr-4",children:[r.jsx(c.Z,{className:"w-4 h-4 mr-2"}),r.jsx("span",{className:"hidden sm:inline",children:"Export PDF"}),r.jsx("span",{className:"sm:hidden",children:"PDF"})]})]}),r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Lapangan"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tanggal"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Jam"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),r.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"TIPE"}),r.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status Reservasi"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aksi"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:0===V.length?r.jsx("tr",{children:r.jsx("td",{colSpan:8,className:"px-6 py-12 text-center text-gray-500",children:"Tidak ada data booking"})}):V.map(e=>(getStatusInfo(e),(0,r.jsxs)("tr",{children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("div",{children:r.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.field_name})})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.user.name}),r.jsx("div",{className:"text-sm text-gray-500",children:e.user.phone||"No phone"})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:formatDate(e.reservation_date)}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[formatTime(e.start_time)," - ",formatTime(e.end_time)]}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["Rp ",e.total_price.toLocaleString("id-ID")]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center align-middle",children:r.jsx("span",{className:`inline-flex items-center justify-center px-3 py-1 rounded-full text-xs font-medium ${"DP"===e.payment_type?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:"DP"===e.payment_type?"DP":"Lunas"})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center align-middle",children:r.jsx("span",{className:`inline-flex items-center justify-center px-3 py-1 rounded-full text-xs font-medium ${getStatusInfo(e).color}`,children:getStatusInfo(e).text})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("button",{onClick:()=>handleShowDetail(e),className:`inline-flex items-center px-3 py-1 rounded-md text-xs font-medium ${"DP_PAID"===e.status?"bg-green-100 text-green-800 hover:bg-green-200":"bg-gray-100 text-gray-800 hover:bg-gray-200"}`,children:[r.jsx(m.Z,{className:"w-3 h-3 mr-1"}),"Detail"]}),"CANCELLED"!==e.status&&"REJECTED"!==e.status&&(0,r.jsxs)("button",{onClick:()=>handleShowReschedule(e),className:"inline-flex items-center px-3 py-1 rounded-md text-xs font-medium bg-blue-100 text-blue-800 hover:bg-blue-200",title:"Reschedule booking",children:[r.jsx(u.Z,{className:"w-3 h-3 mr-1"}),"Reschedule"]})]})})]},e.id)))})]})})]})]})]}),A&&r.jsx(x.Z,{reservation:A,isOpen:$,onClose:()=>{R(!1),I(null)},onPaymentStatusUpdate:handlePaymentStatusUpdate,onDelete:fetchReservations}),M&&Z&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[100] p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg max-w-5xl max-h-[90vh] overflow-hidden shadow-2xl",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-4 border-b bg-gray-50",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Bukti Pembayaran"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Klik download untuk menyimpan file"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("a",{href:Z,download:`bukti-pembayaran-${Date.now()}.jpg`,className:"flex items-center space-x-1 px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm",children:[r.jsx(c.Z,{className:"w-4 h-4"}),r.jsx("span",{children:"Download"})]}),r.jsx("button",{onClick:()=>{B(!1),F(null),U(null)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:r.jsx(g.Z,{className:"w-6 h-6"})})]})]}),r.jsx("div",{className:"p-4 bg-gray-50",children:r.jsx("div",{className:"relative",children:r.jsx("img",{src:Z,alt:"Bukti Pembayaran",className:"max-w-full max-h-[70vh] object-contain mx-auto rounded-lg shadow-lg"})})})]})}),q&&r.jsx(RescheduleModal,{isOpen:G,onClose:()=>{W(!1),H(null)},reservation:q,onSuccess:()=>{fetchReservations()}})]})}},9101:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>l,__esModule:()=>n,default:()=>o});var r=a(95153);let s=(0,r.createProxy)(String.raw`C:\Projects\backup 07-11-2025 4.11\gorpuribeta-main\app\admin\booking\page.tsx`),{__esModule:n,$$typeof:l}=s,i=s.default,o=i}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[2006,2246,7756,4658,5835,6897,8147,2039],()=>__webpack_exec__(11468));module.exports=a})();