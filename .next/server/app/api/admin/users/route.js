"use strict";(()=>{var e={};e.id=2628,e.ids=[2628],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},48774:(e,r,s)=>{s.r(r),s.d(r,{headerHooks:()=>h,originalPathname:()=>g,requestAsyncStorage:()=>_,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>v});var t={};s.r(t),s.d(t,{GET:()=>GET,POST:()=>POST});var a=s(10884),i=s(16132),u=s(95798),n=s(15204),o=s(62421),d=s.n(o),p=s(8192);async function GET(e){try{let r=(0,p.Ym)(e);if(!r)return u.Z.json({error:"Unauthorized"},{status:401});if("ADMIN"!==r.role)return u.Z.json({error:"Forbidden - Admin access required"},{status:403});let{searchParams:s}=new URL(e.url),t=parseInt(s.get("page")||"1"),a=parseInt(s.get("limit")||"10"),i=s.get("search")||"",o=s.get("role")||"",d={};i&&(d.OR=[{nama_user:{contains:i,mode:"insensitive"}},{email_user:{contains:i,mode:"insensitive"}},{phone_user:{contains:i,mode:"insensitive"}}]),o&&(d.role=o);let[l,_]=await Promise.all([n._.user.findMany({where:d,select:{id_user:!0,nama_user:!0,email_user:!0,phone_user:!0,role:!0,isActive:!0,user_dibuat_pada:!0,user_diupdate_pada:!0,_count:{select:{reservasi:!0}}},orderBy:{user_dibuat_pada:"desc"},skip:(t-1)*a,take:a}),n._.user.count({where:d})]),c=Math.ceil(_/a),m=l.map(e=>({id:e.id_user,name:e.nama_user,email:e.email_user,phone:e.phone_user,role:e.role,isActive:e.isActive,createdAt:e.user_dibuat_pada.toISOString(),updatedAt:e.user_diupdate_pada.toISOString(),_count:e._count}));return u.Z.json({users:m,pagination:{page:t,limit:a,totalCount:_,totalPages:c,hasNext:t<c,hasPrev:t>1}})}catch(e){return console.error("Error fetching users:",e),u.Z.json({error:"Internal server error"},{status:500})}}async function POST(e){try{let r=(0,p.Ym)(e);if(!r)return u.Z.json({error:"Unauthorized"},{status:401});if("ADMIN"!==r.role)return u.Z.json({error:"Forbidden - Admin access required"},{status:403});let s=await e.json(),{name:t,email:a,phone:i,role:o="USER",password:l}=s;if(!t||!a||!l)return u.Z.json({error:"Name, email, and password are required"},{status:400});let _=await n._.user.findUnique({where:{email_user:a}});if(_)return u.Z.json({error:"User with this email already exists"},{status:409});let c=await d().hash(l,12),m=await n._.user.create({data:{nama_user:t,email_user:a,phone_user:i||null,role:o,password:c,isActive:!0},select:{id_user:!0,nama_user:!0,email_user:!0,phone_user:!0,role:!0,isActive:!0,user_dibuat_pada:!0,user_diupdate_pada:!0}}),h={id:m.id_user,name:m.nama_user,email:m.email_user,phone:m.phone_user,role:m.role,isActive:m.isActive,createdAt:m.user_dibuat_pada.toISOString(),updatedAt:m.user_diupdate_pada.toISOString()};return u.Z.json({message:"User created successfully",user:h},{status:201})}catch(e){return console.error("Error creating user:",e),u.Z.json({error:"Internal server error"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/users/route",pathname:"/api/admin/users",filename:"route",bundlePath:"app/api/admin/users/route"},resolvedPagePath:"C:\\Projects\\backup 07-11-2025 4.11\\gorpuribeta-main\\app\\api\\admin\\users\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:_,staticGenerationAsyncStorage:c,serverHooks:m,headerHooks:h,staticGenerationBailout:v}=l,g="/api/admin/users/route"}};var r=require("../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),s=r.X(0,[2006,8107,6721,2421,390],()=>__webpack_exec__(48774));module.exports=s})();