"use strict";(()=>{var e={};e.id=8213,e.ids=[8213],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},46779:(e,a,r)=>{r.r(a),r.d(a,{headerHooks:()=>c,originalPathname:()=>b,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>_,staticGenerationAsyncStorage:()=>u,staticGenerationBailout:()=>p});var t={};r.r(t),r.d(t,{GET:()=>GET,POST:()=>POST});var n=r(10884),m=r(16132),i=r(95798),s=r(15204),o=r(8192);async function GET(e){try{let a=(0,o.Ym)(e);if(!a)return i.Z.json({error:"Unauthorized"},{status:401});if("ADMIN"!==a.role)return i.Z.json({error:"Forbidden - Admin access required"},{status:403});let r=await s._.member.findMany({include:{lapangan:{select:{id_lapangan:!0,nama_lapangan:!0}}},orderBy:{member_dibuat_pada:"desc"}}),t=r.map(e=>({id:e.id_member,name:e.nama_member,contactName:e.kontak_member,fieldId:e.id_lapangan,dayOfWeek:e.dayOfWeek,startTime:e.jam_mulai_member,endTime:e.jam_selesai_member,packageType:e.jenis_paket_member,startDate:e.tanggal_mulai_member.toISOString(),endDate:e.tanggal_berakhir_member.toISOString(),isActive:e.isActive,createdAt:e.member_dibuat_pada.toISOString(),updatedAt:e.member_diupdate_pada.toISOString(),field:{id:e.lapangan.id_lapangan,name:e.lapangan.nama_lapangan}}));return i.Z.json({members:t})}catch(e){return console.error("Error fetching members:",e),i.Z.json({error:"Failed to fetch members"},{status:500})}}async function POST(e){try{let a=(0,o.Ym)(e);if(!a)return i.Z.json({error:"Unauthorized"},{status:401});if("ADMIN"!==a.role)return i.Z.json({error:"Forbidden - Admin access required"},{status:403});let r=await e.json(),{name:t,contactName:n,fieldId:m,schedules:d,dayOfWeek:l,startTime:u,endTime:_,packageType:c="MONTHLY_1",startDate:p}=r;if(console.log("Received data:",{name:t,contactName:n,fieldId:m,schedules:d,dayOfWeek:l,startTime:u,endTime:_,packageType:c,startDate:p}),!t||!n||!m)return i.Z.json({error:"Missing required fields: name, contactName, fieldId"},{status:400});let b=d&&Array.isArray(d)?d:l&&u&&_?[{dayOfWeek:l,startTime:u,endTime:_}]:[];if(0===b.length)return i.Z.json({error:"At least one schedule is required"},{status:400});let g="string"==typeof m?parseInt(m):m;if(isNaN(g))return i.Z.json({error:"Invalid field ID"},{status:400});let f=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY","SUNDAY"];for(let e of b){if(!f.includes(e.dayOfWeek))return i.Z.json({error:`Invalid day of week: ${e.dayOfWeek}`},{status:400});if(!e.startTime||!e.endTime)return i.Z.json({error:"Each schedule must have startTime and endTime"},{status:400})}let k=await s._.member.findMany({where:{id_lapangan:g,isActive:!0},select:{id_member:!0,nama_member:!0,dayOfWeek:!0,jam_mulai_member:!0,jam_selesai_member:!0}}),timeRangesOverlap=(e,a,r,t)=>{let n=e.replace(":",""),m=a.replace(":",""),i=r.replace(":",""),s=t.replace(":","");return n<s&&m>i},h=[];for(let e of b)for(let a of k)a.dayOfWeek===e.dayOfWeek&&timeRangesOverlap(e.startTime,e.endTime,a.jam_mulai_member,a.jam_selesai_member)&&h.push({day:e.dayOfWeek,time:`${e.startTime}-${e.endTime}`,conflictWith:a.nama_member,conflictTime:`${a.jam_mulai_member}-${a.jam_selesai_member}`});if(h.length>0){let e={MONDAY:"Senin",TUESDAY:"Selasa",WEDNESDAY:"Rabu",THURSDAY:"Kamis",FRIDAY:"Jumat",SATURDAY:"Sabtu",SUNDAY:"Minggu"},a=h.map(a=>`${e[a.day]||a.day} ${a.time} bentrok dengan ${a.conflictWith} (${a.conflictTime})`).join(", ");return i.Z.json({error:"Jadwal bentrok dengan member lain",conflicts:h,message:a},{status:409})}let M=p?new Date(p):new Date,j=new Date(M);switch(c){case"MEMBER_1":case"MONTHLY_1":default:j.setMonth(j.getMonth()+1);break;case"MEMBER_2":j.setMonth(j.getMonth()+2);break;case"MEMBER_3":case"MONTHLY_3":j.setMonth(j.getMonth()+3);break;case"MEMBER_4":j.setMonth(j.getMonth()+4);break;case"MEMBER_5":j.setMonth(j.getMonth()+5);break;case"MEMBER_6":case"MONTHLY_6":j.setMonth(j.getMonth()+6);break;case"MEMBER_PLUS":case"MONTHLY_12":j.setMonth(j.getMonth()+12)}let A=[];for(let e of b){let a=await s._.member.create({data:{nama_member:t,kontak_member:n,id_lapangan:g,dayOfWeek:e.dayOfWeek,jam_mulai_member:e.startTime,jam_selesai_member:e.endTime,jenis_paket_member:c,tanggal_mulai_member:M,tanggal_berakhir_member:j},include:{lapangan:{select:{id_lapangan:!0,nama_lapangan:!0,harga_per_jam:!0}}}});A.push(a)}console.log("Members created successfully:",A.length,"schedules");let S=A.map(e=>({id:e.id_member,name:e.nama_member,contactName:e.kontak_member,fieldId:e.id_lapangan,dayOfWeek:e.dayOfWeek,startTime:e.jam_mulai_member,endTime:e.jam_selesai_member,packageType:e.jenis_paket_member,startDate:e.tanggal_mulai_member.toISOString(),endDate:e.tanggal_berakhir_member.toISOString(),isActive:e.isActive,createdAt:e.member_dibuat_pada.toISOString(),updatedAt:e.member_diupdate_pada.toISOString(),field:{id:e.lapangan.id_lapangan,name:e.lapangan.nama_lapangan,pricePerHour:e.lapangan.harga_per_jam}}));return i.Z.json({members:S,message:`Member berhasil ditambahkan dengan ${A.length} jadwal. Slot waktu akan otomatis diblokir untuk user.`},{status:201})}catch(e){return console.error("Error creating member:",e),e instanceof Error&&(console.error("Error message:",e.message),console.error("Error stack:",e.stack)),i.Z.json({error:"Failed to create member",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:m.x.APP_ROUTE,page:"/api/admin/members/route",pathname:"/api/admin/members",filename:"route",bundlePath:"app/api/admin/members/route"},resolvedPagePath:"C:\\Projects\\backup 07-11-2025 4.11\\gorpuribeta-main\\app\\api\\admin\\members\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:l,staticGenerationAsyncStorage:u,serverHooks:_,headerHooks:c,staticGenerationBailout:p}=d,b="/api/admin/members/route"}};var a=require("../../../../webpack-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),r=a.X(0,[2006,8107,6721,390],()=>__webpack_exec__(46779));module.exports=r})();