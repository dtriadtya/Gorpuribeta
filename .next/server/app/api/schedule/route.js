"use strict";(()=>{var e={};e.id=5225,e.ids=[5225],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},73021:(e,a,t)=>{t.r(a),t.d(a,{headerHooks:()=>g,originalPathname:()=>p,requestAsyncStorage:()=>o,routeModule:()=>m,serverHooks:()=>_,staticGenerationAsyncStorage:()=>u,staticGenerationBailout:()=>d});var r={};t.r(r),t.d(r,{GET:()=>GET});var l=t(10884),n=t(16132),s=t(95798),i=t(15204);async function GET(e){try{let{searchParams:a}=new URL(e.url),t=a.get("fieldId");if(!t)return s.Z.json({error:"Field ID is required"},{status:400});let r=await i._.field.findFirst({where:{id_lapangan:parseInt(t),isActive:!0}});if(!r)return s.Z.json({error:"Field not found"},{status:404});let l=[],n=new Date,m=new Date(n);m.setHours(0,0,0,0);let o=new Date(n);o.setDate(o.getDate()+365),o.setHours(23,59,59,999),console.log("\uD83D\uDE80 Fetching all active members...");let u=await i._.member.findMany({where:{id_lapangan:parseInt(t),isActive:!0}}),_=u.filter(e=>{let a=new Date(e.tanggal_berakhir_member);return a>=m});console.log(`âœ… Found ${_.length} active members with valid package`),console.log("\uD83D\uDCCB Member details:",_.map(e=>({id:e.id_member,name:e.nama_member,day:e.dayOfWeek,time:`${e.jam_mulai_member}-${e.jam_selesai_member}`,packageValid:`${new Date(e.tanggal_mulai_member).toLocaleDateString()} - ${new Date(e.tanggal_berakhir_member).toLocaleDateString()}`}))),console.log("\uD83D\uDE80 Fetching all reservations...");let g=await i._.reservation.findMany({where:{id_lapangan:parseInt(t),tanggal_reservasi:{gte:m,lte:o},status_reservasi:{notIn:["CANCELLED","REJECTED"]}},select:{id_reservasi:!0,jam_mulai_reservasi:!0,jam_selesai_reservasi:!0,status_reservasi:!0,status_pembayaran:!0,tanggal_reservasi:!0}});console.log(`âœ… Found ${g.length} reservations`);let d=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"];for(let e=0;e<365;e++){let a=new Date(n);a.setDate(n.getDate()+e);let t=new Date(a.getFullYear(),a.getMonth(),a.getDate()),s=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),m=String(t.getDate()).padStart(2,"0"),o=`${s}-${i}-${m}`,u=d[t.getDay()],p=_.filter(e=>{if(e.dayOfWeek!==u)return!1;let a=new Date(t),r=new Date(e.tanggal_mulai_member),l=new Date(e.tanggal_berakhir_member);return a.setHours(0,0,0,0),r.setHours(0,0,0,0),l.setHours(23,59,59,999),a>=r&&a<=l});("2026-06-16"===o||"2026-02-03"===o||"2026-09-01"===o)&&(console.log(`ðŸ” DEBUG for ${o}:`),console.log("  dayOfWeek:",u),console.log("  All active members:",_.map(e=>({name:e.nama_member,day:e.dayOfWeek,time:`${e.jam_mulai_member}-${e.jam_selesai_member}`,packageStart:new Date(e.tanggal_mulai_member).toLocaleDateString(),packageEnd:new Date(e.tanggal_berakhir_member).toLocaleDateString()}))),console.log("  Filtered activeMembers for this date:",p.map(e=>({name:e.nama_member,day:e.dayOfWeek,time:`${e.jam_mulai_member}-${e.jam_selesai_member}`}))),console.log("  Number of filtered members:",p.length));let c=g.filter(e=>{let a=new Date(e.tanggal_reservasi),t=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;return t===o}),b=[];for(let e=6;e<22;e++){let a=`${e.toString().padStart(2,"0")}:00`,t=c.find(a=>{let t=parseInt(a.jam_mulai_reservasi.split(":")[0]),r=parseInt(a.jam_selesai_reservasi.split(":")[0]);return e>=t&&e<r}),l=p.find(a=>{let t=parseInt(a.jam_mulai_member.split(":")[0]),r=parseInt(a.jam_selesai_member.split(":")[0]);return e>=t&&e<r});"2026-06-16"===o&&9===e&&(console.log(`ðŸ” Checking hour ${e}:00 on ${o}`),console.log("  Active members for this day:",p.length),p.forEach(a=>{console.log(`    - ${a.nama_member}: ${a.jam_mulai_member} - ${a.jam_selesai_member}`),console.log(`      Start hour: ${parseInt(a.jam_mulai_member.split(":")[0])}, End hour: ${parseInt(a.jam_selesai_member.split(":")[0])}`),console.log(`      Should block? ${e>=parseInt(a.jam_mulai_member.split(":")[0])&&e<parseInt(a.jam_selesai_member.split(":")[0])}`)}),console.log("  blockedByMember:",l?l.nama_member:"none")),b.push({time:a,available:!t&&!l,price:r.harga_per_jam,status:t?"booked":l?"member":"available",reservationId:t?t.id_reservasi:null,memberInfo:l?{name:l.nama_member,contactName:l.kontak_member}:null})}l.push({date:o,timeSlots:b})}return s.Z.json({success:!0,schedule:l,field:{id:r.id_lapangan,name:r.nama_lapangan,price_per_hour:r.harga_per_jam,image_url:r.imageUrl,description:r.deskripsi}})}catch(e){return console.error("Error fetching schedule:",e),s.Z.json({error:"Internal server error"},{status:500})}}let m=new l.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/schedule/route",pathname:"/api/schedule",filename:"route",bundlePath:"app/api/schedule/route"},resolvedPagePath:"C:\\Projects\\backup 07-11-2025 4.11\\gorpuribeta-main\\app\\api\\schedule\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:o,staticGenerationAsyncStorage:u,serverHooks:_,headerHooks:g,staticGenerationBailout:d}=m,p="/api/schedule/route"},15204:(e,a,t)=>{t.d(a,{_:()=>l});var r=t(53524);let l=global.prisma||new r.PrismaClient({log:["error"]})}};var a=require("../../../webpack-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),t=a.X(0,[2006,8107],()=>__webpack_exec__(73021));module.exports=t})();