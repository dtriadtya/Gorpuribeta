"use strict";(()=>{var e={};e.id=5510,e.ids=[5510],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},34485:(e,r,a)=>{a.r(r),a.d(r,{headerHooks:()=>v,originalPathname:()=>c,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>p,staticGenerationAsyncStorage:()=>_,staticGenerationBailout:()=>m});var s={};a.r(s),a.d(s,{PATCH:()=>PATCH});var t=a(10884),i=a(16132),n=a(95798),o=a(15204),u=a(8192);async function PATCH(e,{params:r}){try{let a=await (0,u.Ym)(e);if(!a||"ADMIN"!==a.role)return n.Z.json({error:"Unauthorized. Admin access required."},{status:401});let s=parseInt(r.id),t=await e.json(),{newDate:i,newStartTime:l,newEndTime:d,adminNotes:_}=t;if(!i||!l||!d)return n.Z.json({error:"Missing required fields: newDate, newStartTime, newEndTime"},{status:400});let p=await o._.reservation.findUnique({where:{id_reservasi:s},include:{lapangan:!0,user:!0}});if(!p)return n.Z.json({error:"Reservation not found"},{status:404});let v=await o._.reservation.findFirst({where:{id_lapangan:p.id_lapangan,tanggal_reservasi:new Date(i),id_reservasi:{not:s},status_reservasi:{in:["PENDING","DP_PAID"]},OR:[{AND:[{jam_mulai_reservasi:{lte:l}},{jam_selesai_reservasi:{gt:l}}]},{AND:[{jam_mulai_reservasi:{lt:d}},{jam_selesai_reservasi:{gte:d}}]},{AND:[{jam_mulai_reservasi:{gte:l}},{jam_selesai_reservasi:{lte:d}}]}]}});if(v)return n.Z.json({error:"Jadwal baru bentrok dengan booking lain"},{status:409});let m=await o._.reservation.update({where:{id_reservasi:s},data:{tanggal_reservasi:new Date(i),jam_mulai_reservasi:l,jam_selesai_reservasi:d,notes:_||p.notes,reservasi_diupdate_pada:new Date},include:{user:{select:{id_user:!0,nama_user:!0,email_user:!0,phone_user:!0}},lapangan:{select:{id_lapangan:!0,nama_lapangan:!0}}}});return n.Z.json({message:"Reschedule berhasil",reservation:{...m,field_name:m.lapangan.nama_lapangan,payment_validated_admin:null}})}catch(e){return console.error("Error rescheduling reservation:",e),n.Z.json({error:"Failed to reschedule reservation"},{status:500})}}let l=new t.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/reservations/[id]/reschedule/route",pathname:"/api/reservations/[id]/reschedule",filename:"route",bundlePath:"app/api/reservations/[id]/reschedule/route"},resolvedPagePath:"C:\\Projects\\backup 07-11-2025 4.11\\gorpuribeta-main\\app\\api\\reservations\\[id]\\reschedule\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:_,serverHooks:p,headerHooks:v,staticGenerationBailout:m}=l,c="/api/reservations/[id]/reschedule/route"}};var r=require("../../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),a=r.X(0,[2006,8107,6721,390],()=>__webpack_exec__(34485));module.exports=a})();