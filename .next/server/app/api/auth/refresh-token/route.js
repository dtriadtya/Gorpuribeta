"use strict";(()=>{var e={};e.id=9318,e.ids=[9318],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},74233:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>_,originalPathname:()=>g,requestAsyncStorage:()=>k,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>m});var s={};t.r(s),t.d(s,{POST:()=>POST});var o=t(10884),n=t(16132),a=t(95798),i=t(96721),u=t.n(i),l=t(6113),p=t.n(l),d=t(15204);async function POST(e){try{let r=e.headers.get("authorization");if(!r)return a.Z.json({error:"Token tidak ditemukan"},{status:401});let t=r.replace("Bearer ",""),s=u().verify(t,process.env.JWT_SECRET||"fallback-secret",{ignoreExpiration:!1});console.log(`ðŸ”„ Refreshing token for user ${s.userId}`),console.log("  Has sessionToken in JWT?",!!s.sessionToken);let o=await d._.user.findUnique({where:{id_user:s.userId},select:{id_user:!0,nama_user:!0,email_user:!0,phone_user:!0,role:!0,isActive:!0}});if(!o)return a.Z.json({error:"User tidak ditemukan"},{status:404});if(!o.isActive)return a.Z.json({error:"Akun tidak aktif"},{status:403});let n=p().randomBytes(32).toString("hex");console.log(`âœ… New session token generated for ${o.email_user}`);let i=u().sign({userId:o.id_user,email:o.email_user,role:o.role,sessionToken:n},process.env.JWT_SECRET||"fallback-secret",{expiresIn:"7d"});return a.Z.json({message:"Token berhasil diperbarui",token:i,user:o})}catch(e){if(console.error("Error refreshing token:",e),e instanceof u().TokenExpiredError)return a.Z.json({error:"Token expired"},{status:401});return a.Z.json({error:"Token tidak valid"},{status:401})}}let c=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/refresh-token/route",pathname:"/api/auth/refresh-token",filename:"route",bundlePath:"app/api/auth/refresh-token/route"},resolvedPagePath:"C:\\Projects\\backup 07-11-2025 4.11\\gorpuribeta-main\\app\\api\\auth\\refresh-token\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:k,staticGenerationAsyncStorage:f,serverHooks:h,headerHooks:_,staticGenerationBailout:m}=c,g="/api/auth/refresh-token/route"},15204:(e,r,t)=>{t.d(r,{_:()=>o});var s=t(53524);let o=global.prisma||new s.PrismaClient({log:["error"]})}};var r=require("../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[2006,8107,6721],()=>__webpack_exec__(74233));module.exports=t})();